(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,,,,,,,,,,function(t,i,s){},function(t,i,s){},,,,,function(t,i,s){t.exports=s(36)},,,,,function(t,i,s){},function(t,i,s){},,,,,,,function(t,i,s){},function(t,i,s){},function(t,i,s){},function(t,i,s){},function(t,i,s){"use strict";s.r(i);var e=s(1),a=s.n(e),h=s(17),n=s.n(h),r=(s(24),s(25),s(2)),o=s(3),l=s(8),c=s(7),u=s(9),p=s(11),f=(s(13),function(t){function i(t){var s;return Object(r.a)(this,i),(s=Object(l.a)(this,Object(c.a)(i).call(this,t))).viewSelectorItemClicked=s.viewSelectorItemClicked.bind(Object(p.a)(s)),s}return Object(u.a)(i,t),Object(o.a)(i,[{key:"viewSelectorItemClicked",value:function(t){"function"===typeof this.props.viewSelectorItemClicked&&this.props.viewSelectorItemClicked(t)}},{key:"render",value:function(){var t=this,i="view-selector-item",s="view-selector-item";return"2d"===this.props.currentView?i+=" active":s+=" active",a.a.createElement("div",{className:"view-selector"},a.a.createElement("span",{className:i,onClick:function(){t.viewSelectorItemClicked("2d")}},"2D"),a.a.createElement("span",{className:s,onClick:function(){t.viewSelectorItemClicked("3d")}},"3D"))}}]),i}(e.Component)),m=s(12),_=s(0),b="table.babylon",d="bat.babylon",R=396,V=5.715,v=6,M=7,y=8,g=9,N=10,P=11,x=12,q=13,C=14,X=15,Y=16,A=function t(){Object(r.a)(this,t),this.played=!1},S=function t(){Object(r.a)(this,t)},w=function t(i,s){var e=this;Object(r.a)(this,t),this.delta_fgpas=.004375,this.RSG=1,this.fgpas=.00125,this.EPSILON=.86,this.frpas=3e-5,this.QCQ=2,this.Rfppas=75e-6,this.f1=.25,this.f2=.42,this.Rfp=.15,this.fbille=.05,this.pas=5e-4,this.fp1=.2,this.ARRET=0,this.TSP=3,this.fg=2.5,this.fr=.06,this.choc_bande=function(t){var i=NaN;if(e.X[t]>e.XMIN&&e.X[t]<e.XMAX&&e.Y[t]>e.YMIN&&e.Y[t]<e.YMAX)return!1;if(e.X[t]<e.XMIN&&e.Vx[t]>0)return!1;if(e.X[t]>e.XMAX&&e.Vx[t]<0)return!1;if(e.Y[t]>e.YMAX&&e.Vy[t]<0)return!1;if(e.Y[t]<e.YMIN&&e.Vy[t]>0)return!1;if(0==t&&(!e.choc12||!e.choc13)){var s=e,a=e.nbandes+1;if(s.nbandes=a,!e.choc12&&!e.choc13){s=e,a=e.nb_b_avant+1;s.nb_b_avant=a}}return e.etat[t]==e.RSG?(e.Rp[t]=-e.Vy[t],e.Rq[t]=e.Vx[t]):e.etat[t]==e.QCQ&&(e.Rp[t]=-e.Vy[t]+e.VQy[t],e.Rq[t]=e.Vx[t]-e.VQx[t]),e.init_pars(t),e.VMz=e.VT-e.VRr,e.VN0=-e.VN,e.VN=e.VN*-e.EPSILON,e.deltaVN=e.VN0+e.VN,e.intens=e.VN0/20,e.intens>1&&(e.intens=1),e.beta_adh=2/7*Math.sqrt(e.VMz*e.VMz+e.VRq*e.VRq),e.beta_gliss=e.f1*e.deltaVN,Math.abs(e.VMz)<1e-5?e.alpha_bande=Math.PI/2:e.alpha_bande=Math.abs(Math.atan(e.VRq/e.VMz)),i=Math.abs(e.fp1*e.deltaVN),Math.abs(e.VRp)<i?e.VRp=0:e.VRp>0?e.VRp=e.VRp-i:e.VRp=e.VRp+i,i=Math.abs(e.f2*e.deltaVN),e.VRq=e.VRq+i,e.beta_gliss>e.beta_adh?e.choc_adh(t):e.choc_gliss(t),e.recup_pars(t),e.VQx[t]=e.Vx[t]-e.Rq[t],e.VQy[t]=e.Vy[t]+e.Rp[t],e.etat[t]=e.QCQ,!0},this.fin_parcours=function(){var t=0;for(t=0;t<3;){if(e.etat[t]!=e.ARRET){if(!(e.Vx[t]*e.Vx[t]+e.Vy[t]*e.Vy[t]<e.frpas*e.frpas))return!1;if(!(Math.abs(e.Rr[t])<e.Rfppas))return e.etat[t]=e.TSP,!1;e.etat[t]=e.ARRET;var i=0;e.Vy[t]=0,e.Vx[t]=i;i=0;e.Rr[t]=0,e.Rq[t]=i,e.Rp[t]=i}t++}return!0},this.Calcul=function(t){console.log("parameter",t);var i,s,a=0,h=0,n=NaN,r=[];for(a=0;a<3;){for(e.nb_clefs[a]=0,h=0;h<e.nb_max_clefs;)e.evts[e.nb_max_clefs*a+h]=null,h++;a++}for(e.nb_sons=0,a=0;a<e.nb_max_sons;)e.evts_son[a]=null,a++;for(a=0;a<3;)e.X[a]=t.Xinit[a],e.Y[a]=t.Yinit[a],e.RAp[a]=t.RApInit[a],e.RAq[a]=t.RAqInit[a],e.RAr[a]=t.RArInit[a],e.add_clef(a),a++;e.el=t.el,e.er=t.er,e.alph=t.alphaQ,e.beta=t.betaQ,e.vqueue=t.Vqueue,e.calculs_finis=!1,e.nbandes=0,e.done=!1,e.distance13=2,e.first_bille_choquee=0,e.choc12=!1,e.choc13=!1,e.done=!1,e.deltaclef=e.resolution,e.date=0,e.beta=e.beta+Math.PI,e.Vinit=1.4*e.vqueue*Math.cos(e.alph/1.2),i=-2*e.Vinit/Math.cos(e.alph/1.1)*e.er/e.R;var o=Math.PI/20;n=e.alph>o?Math.PI/2/(Math.PI/2-o)*(e.alph-o):0,s=4*e.vqueue*Math.sin(n)*e.el/e.R,e.Vx[0]=e.Vinit*Math.cos(e.beta),e.Vx0=e.Vx[0],e.Vy[0]=e.Vinit*Math.sin(e.beta),e.Vy0=e.Vy[0];var l=i*Math.sin(e.beta)+s*Math.cos(e.beta);e.Rp[0]=i*Math.sin(e.beta)+s*Math.cos(e.beta),e.p0=l;l=-i*Math.cos(e.beta)+s*Math.sin(e.beta);e.Rq[0]=-i*Math.cos(e.beta)+s*Math.sin(e.beta),e.q0=l;l=2*e.el/e.R*e.Vinit;for(e.Rr[0]=2*e.el/e.R*e.Vinit,e.r0=l,e.VQx[0]=e.Vx[0]-e.Rq[0],e.VQy[0]=e.Vy[0]+e.Rp[0],e.etat[0]=e.QCQ,a=1;a<3;)e.Vx[a]=0,e.Vy[a]=0,e.VQx[a]=0,e.VQy[a]=0,e.Rp[a]=0,e.Rq[a]=0,e.Rr[a]=0,e.etat[a]=e.ARRET,e.add_clef(a),a++;for(e.evts_son[e.nb_sons]=new A,e.evts_son[e.nb_sons].played=!1,e.evts_son[e.nb_sons].temps=0,e.evts_son[e.nb_sons].intensite=e.Vinit/5.4,e.alph>Math.PI/4?e.evts_son[e.nb_sons].type_choc=0:e.evts_son[e.nb_sons].type_choc=1;!e.fin_parcours();)for(e.date+=1,e.choc_billes(r),a=0;a<3;){if(e.etat[a]!=e.ARRET){if(e.choc_bande(a)){e.add_clef(a),e.evts_son[e.nb_sons]=new A,e.evts_son[e.nb_sons].played=!1,e.evts_son[e.nb_sons].temps=e.date*e.pas,e.evts_son[e.nb_sons].intensite=e.intens,e.evts_son[e.nb_sons].type_choc=3;l=e;var c=e.nb_sons+1;l.nb_sons=c}e.mise_a_jour(a)&&e.add_clef(a)}(Math.abs(e.X[a]-e.X0[a])>e.deltaclef||Math.abs(e.Y[a]-e.Y0[a])>e.deltaclef||Math.abs(e.RAp[a]-e.RAp0[a])>e.deltaclefRot||Math.abs(e.RAq[a]-e.RAq0[a])>e.deltaclefRot||Math.abs(e.RAr[a]-e.RAr0[a])>e.deltaclefRot)&&e.add_clef(a),a++}if(e.fin_parcours()){e.calculs_finis=!0;for(a=0;a<3;a++)e.Xfin[a]=e.X[a],e.Yfin[a]=e.Y[a],e.RApfin[a]=e.RAp[a],e.RAqfin[a]=e.RAq[a],e.RArfin[a]=e.RAr[a],e.add_clef(a);e.duree=e.date*e.pas}else for(a=0;a<3;a++)e.add_clef(a);return e.evts},this.mise_a_jour=function(t){var i=NaN,s=NaN,a=NaN,h=NaN,n=NaN;if(0!=e.first_bille_choquee&&(e.nb3=3-e.first_bille_choquee,e.d13=Math.sqrt((e.X[0]-e.X[e.nb3])*(e.X[0]-e.X[e.nb3])+(e.Y[0]-e.Y[e.nb3])*(e.Y[0]-e.Y[e.nb3])),e.d13<e.distance13&&(e.distance13=e.d13)),e.etat[t]==e.RSG){if((i=Math.sqrt(e.Vx[t]*e.Vx[t]+e.Vy[t]*e.Vy[t]))<e.frpas){var r=0;e.Vy[t]=0,e.Vx[t]=r;r=0;if(e.Rq[t]=0,e.Rp[t]=r,Math.abs(e.Rr[t])<e.Rfppas)return e.etat[t]=e.ARRET,e.Rr[t]=0,e.add_clef(t),!0;e.etat[t]=e.TSP}e.etat[t]!=e.TSP&&(s=1-e.frpas/i,e.Vx[t]=e.Vx[t]*s,e.Vy[t]=e.Vy[t]*s,e.Rp[t]=-e.Vy[t],e.Rq[t]=e.Vx[t]),Math.abs(e.Rr[t])<e.Rfppas?e.Rr[t]=0:e.Rr[t]>0?e.Rr[t]=e.Rr[t]-e.Rfppas:e.Rr[t]=e.Rr[t]+e.Rfppas}if(e.etat[t]==e.QCQ&&((a=Math.sqrt(e.VQx[t]*e.VQx[t]+e.VQy[t]*e.VQy[t]))<e.delta_fgpas?e.etat[t]=e.RSG:(h=-e.fgpas*e.VQx[t]/a,n=-e.fgpas*e.VQy[t]/a,e.Vx[t]=e.Vx[t]+h,e.Vy[t]=e.Vy[t]+n,s=1-e.delta_fgpas/a,e.VQx[t]=e.VQx[t]*s,e.VQy[t]=e.VQy[t]*s),e.Rp[t]=-e.Vy[t]+e.VQy[t],e.Rq[t]=e.Vx[t]-e.VQx[t],Math.abs(e.Rr[t])<e.Rfppas?e.Rr[t]=0:e.Rr[t]>0?e.Rr[t]=e.Rr[t]-e.Rfppas:e.Rr[t]=e.Rr[t]+e.Rfppas),e.etat[t]==e.TSP){r=0;e.Vy[t]=0,e.Vx[t]=r;r=0;if(e.Rq[t]=0,e.Rp[t]=r,Math.abs(e.Rr[t])<e.Rfppas)return e.Rr[t]=0,e.etat[t]=e.ARRET,!0;e.Rr[t]>0?e.Rr[t]=e.Rr[t]-2*e.Rfppas:e.Rr[t]=e.Rr[t]+2*e.Rfppas}return e.X[t]=e.X[t]+e.Vx[t]*e.pas,e.Y[t]=e.Y[t]+e.Vy[t]*e.pas,e.RAp[t]=e.RAp[t]+e.Rp[t]*e.pas,e.RAq[t]=e.RAq[t]+e.Rq[t]*e.pas,e.RAr[t]=e.RAr[t]+e.Rr[t]*e.pas,!1},this.choc_gliss=function(t){e.VMz>0?(e.VT=e.VT-e.beta_gliss*Math.cos(e.alpha_bande),e.VRr=e.VRr+2.5*e.beta_gliss*Math.cos(e.alpha_bande)):(e.VT=e.VT+e.beta_gliss*Math.cos(e.alpha_bande),e.VRr=e.VRr-2.5*e.beta_gliss*Math.cos(e.alpha_bande))},this.choc_adh=function(t){var i,s,a=NaN,h=NaN,n=NaN,r=NaN,o=NaN,l=0;a=Math.abs(e.VT)<1e-5?90:180/Math.PI*Math.atan(e.VN0/e.VT),e.effet=100*e.R/2*e.VRr/Math.sqrt(e.VN0*e.VN0+e.VT*e.VT),e.effet<=-1.5?e.effet=-1.499:e.effet>1.5&&(e.effet=1.499),Math.abs(e.VT)<1e-5?h=e.effet>0?e.sorties[28]+(e.sorties[29]-e.sorties[28])*(e.effet/1.5):e.sorties[27]+(e.sorties[28]-e.sorties[27])*(e.effet+1.5)/1.5:(a=180/Math.PI*Math.atan(e.VN0/e.VT),l=parseInt(a/10),h=(n=e.effet>0?e.sorties[3*l+1]+(e.sorties[3*l+2]-e.sorties[3*l+1])*(e.effet/1.5):e.sorties[3*l+0]+(e.sorties[3*l+1]-e.sorties[3*l+0])*(e.effet+1.5)/1.5)+((e.effet>0?e.sorties[3*(l+1)+1]+(e.sorties[3*(l+1)+2]-e.sorties[3*(l+1)+1])*(e.effet/1.5):e.sorties[3*(l+1)+0]+(e.sorties[3*(l+1)+1]-e.sorties[3*(l+1)+0])*(e.effet+1.5)/1.5)-n)/10*(a-10*l)),Math.abs(h-90)<1e-5?e.VT=0:e.VT=h<90?e.VN/Math.tan(h/180*Math.PI):-e.VN*Math.tan((h-90)/180*Math.PI),Math.abs(e.VT)<1e-5?e.effet>0?e.e_s=e.eff_s[28]+(e.eff_s[29]-e.eff_s[28])*(e.effet/1.5):e.e_s=e.eff_s[27]+(e.eff_s[28]-e.eff_s[27])*(e.effet+1.5)/1.5:(e.effet>0?(r=e.eff_s[3*l+1]+(e.eff_s[3*l+2]-e.eff_s[3*l+1])*(e.effet/1.5),o=e.eff_s[3*(l+1)+1]+(e.eff_s[3*(l+1)+2]-e.eff_s[3*(l+1)+1])*(e.effet/1.5)):(r=e.eff_s[3*l+0]+(e.eff_s[3*l+1]-e.eff_s[3*l+0])*(e.effet+1.5)/1.5,o=e.eff_s[3*(l+1)+0]+(e.eff_s[3*(l+1)+1]-e.eff_s[3*(l+1)+0])*(e.effet+1.5)/1.5),e.e_s=r+(o-r)/10*(a-10*l)),s=(5*e.VN+2*e.VRq)/7,i=(5*e.VT-2*e.VRp)/7,e.VRr=.02*e.e_s/e.R*Math.sqrt(s*s+i*i)},this.recup_pars=function(t){e.X[t]>e.XMAX&&e.Vx[t]>0&&(e.Vx[t]=-e.VN,e.Rq[t]=-e.VRq,e.Vy[t]>0?(e.Vy[t]=e.VT,e.Rp[t]=e.VRp,e.Rr[t]=-e.VRr):(e.Vy[t]=-e.VT,e.Rp[t]=-e.VRp,e.Rr[t]=e.VRr)),e.X[t]<e.XMIN&&e.Vx[t]<0&&(e.Vx[t]=e.VN,e.Rq[t]=e.VRq,e.Vy[t]>0?(e.Vy[t]=e.VT,e.Rp[t]=e.VRp,e.Rr[t]=e.VRr):(e.Vy[t]=-e.VT,e.Rp[t]=-e.VRp,e.Rr[t]=-e.VRr)),e.Y[t]<e.YMIN&&e.Vy[t]<0&&(e.Vy[t]=e.VN,e.Rp[t]=-e.VRq,e.Vx[t]>0?(e.Vx[t]=e.VT,e.Rq[t]=-e.VRp,e.Rr[t]=-e.VRr):(e.Vx[t]=-e.VT,e.Rq[t]=e.VRp,e.Rr[t]=e.VRr)),e.Y[t]>e.YMAX&&e.Vy[t]>0&&(e.Vy[t]=-e.VN,e.Rp[t]=e.VRq,e.Vx[t]>0?(e.Vx[t]=e.VT,e.Rq[t]=-e.VRp,e.Rr[t]=e.VRr):(e.Vx[t]=-e.VT,e.Rq[t]=e.VRp,e.Rr[t]=-e.VRr))},this.init_pars=function(t){e.X[t]>e.XMAX&&e.Vx[t]>0&&(e.VN=-e.Vx[t],e.VRq=-e.Rq[t],e.Vy[t]>0?(e.VT=e.Vy[t],e.VRp=e.Rp[t],e.VRr=-e.Rr[t]):(e.VT=-e.Vy[t],e.VRp=-e.Rp[t],e.VRr=e.Rr[t])),e.X[t]<e.XMIN&&e.Vx[t]<0&&(e.VN=e.Vx[t],e.VRq=e.Rq[t],e.Vy[t]>0?(e.VT=e.Vy[t],e.VRp=e.Rp[t],e.VRr=e.Rr[t]):(e.VT=-e.Vy[t],e.VRp=-e.Rp[t],e.VRr=-e.Rr[t])),e.Y[t]<e.YMIN&&e.Vy[t]<0&&(e.VN=e.Vy[t],e.VRq=-e.Rp[t],e.Vx[t]>0?(e.VT=e.Vx[t],e.VRp=-e.Rq[t],e.VRr=-e.Rr[t]):(e.VT=-e.Vx[t],e.VRp=e.Rq[t],e.VRr=e.Rr[t])),e.Y[t]>e.YMAX&&e.Vy[t]>0&&(e.VN=-e.Vy[t],e.VRq=e.Rp[t],e.Vx[t]>0?(e.VT=e.Vx[t],e.VRp=-e.Rq[t],e.VRr=e.Rr[t]):(e.VT=-e.Vx[t],e.VRp=e.Rq[t],e.VRr=-e.Rr[t]))},this.add_clef=function(t){var i=e.nb_max_clefs*t+e.nb_clefs[t];e.evts[i]=new S,e.evts[i].X=e.X[t],e.evts[i].Y=e.Y[t],e.evts[i].RAp=e.RAp[t],e.evts[i].RAq=e.RAq[t],e.evts[i].RAr=e.RAr[t],e.evts[i].time=e.date*e.pas;var s=e.nb_clefs,a=t,h=s[t]+1;s[a]=h,e.X0[t]=e.X[t],e.Y0[t]=e.Y[t],e.RAp0[t]=e.RAp[t],e.RAq0[t]=e.RAq[t],e.RAr0[t]=e.RAr[t]},this.choc_billes=function(t){var i=0,s=0,a=!1,h=NaN,n=NaN,r=NaN,o=NaN,l=NaN,c=NaN,u=NaN,p=NaN,f=NaN,m=NaN,_=NaN,b=NaN,d=NaN,R=NaN,V=NaN,v=NaN,M=NaN,y=NaN,g=NaN,N=NaN,P=!1,x=[];for(i=0;i<3;)x[i]=!1,i++;for(i=0;i<3;){if(!x[i]&&(a=!1,s=(i+1)%3,(h=(e.X[i]-e.X[s])*(e.X[i]-e.X[s])+(e.Y[i]-e.Y[s])*(e.Y[i]-e.Y[s]))<e.D*e.D&&(e.etat[i]!=e.ARRET||e.etat[s]!=e.ARRET)&&(e.Vx[i]-e.Vx[s])*(e.X[s]-e.X[i])+(e.Vy[i]-e.Vy[s])*(e.Y[s]-e.Y[i])>0&&(a=!0,P=!0,e.choc12||e.choc13||0!=i||(e.first_bille_choquee=s),0==i&&1==s&&(e.choc12=!0),2==i&&0==s&&(e.choc13=!0),t[0]=i,t[1]=s),a||(s=(i+2)%3,(h=(e.X[i]-e.X[s])*(e.X[i]-e.X[s])+(e.Y[i]-e.Y[s])*(e.Y[i]-e.Y[s]))<e.D*e.D&&(e.etat[i]!=e.ARRET||e.etat[s]!=e.ARRET)&&(e.Vx[i]-e.Vx[s])*(e.X[s]-e.X[i])+(e.Vy[i]-e.Vy[s])*(e.Y[s]-e.Y[i])>0&&(a=!0,P=!0,e.choc12||e.choc13||0!=i||(e.first_bille_choquee=s),1==i&&0==s&&(e.choc12=!0),0==i&&2==s&&(e.choc13=!0),t[0]=i,t[1]=s)),a)){e.add_clef(i),e.add_clef(s),x[i]=!0,e.etat[i]==e.RSG&&(e.Rp[i]=-e.Vy[i],e.Rq[i]=e.Vx[i]),e.etat[i]==e.QCQ&&(e.Rp[i]=-e.Vy[i]+e.VQy[i],e.Rq[i]=e.Vx[i]-e.VQx[i]),e.etat[i]==e.ARRET&&(e.Rp[i]=0,e.Rq[i]=0),x[s]=!0,e.etat[s]==e.RSG&&(e.Rp[s]=-e.Vy[s],e.Rq[s]=e.Vx[s]),e.etat[s]==e.QCQ&&(e.Rp[s]=-e.Vy[s]+e.VQy[s],e.Rq[s]=e.Vx[s]-e.VQx[s]),e.etat[s]==e.ARRET&&(e.Rp[s]=0,e.Rq[s]=0),r=(_=e.Vx[i]*(e.X[s]-e.X[i])+e.Vy[i]*(e.Y[s]-e.Y[i]))*(e.X[s]-e.X[i])/h,o=_*(e.Y[s]-e.Y[i])/h,l=e.Vx[i]-r,c=e.Vy[i]-o,u=(b=e.Vx[s]*(e.X[i]-e.X[s])+e.Vy[s]*(e.Y[i]-e.Y[s]))*(e.X[i]-e.X[s])/h,p=b*(e.Y[i]-e.Y[s])/h,f=e.Vx[s]-u,m=e.Vy[s]-p,R=r-u,V=o-p,e.intens=(R*R+V*V)/5,e.intens>1&&(e.intens=1),e.evts_son[e.nb_sons]=new A,e.evts_son[e.nb_sons].played=!1,e.evts_son[e.nb_sons].temps=e.date*e.pas,e.evts_son[e.nb_sons].intensite=e.intens,e.evts_son[e.nb_sons].type_choc=2;var q=e,C=e.nb_sons+1;q.nb_sons=C,d=r,r=u,u=d,u*=e.RendementChoc,r*=e.RendementChoc,d=o,o=p,p=d,p*=e.RendementChoc,o*=e.RendementChoc,e.Vx[i]=r+l,e.Vy[i]=o+c,e.VQx[i]=e.Vx[i]-e.Rq[i],e.VQy[i]=e.Vy[i]+e.Rp[i],e.etat[s]==e.ARRET&&(e.Vx[s]=.94*e.Vx[s],e.Vy[s]=.94*e.Vy[s],_/=n=Math.sqrt(h),_=Math.abs(_),g=e.fbille*_,v=Math.abs(e.Rp[i]*(e.Y[s]-e.Y[i])-e.Rq[i]*(e.X[s]-e.X[i]))/n,y=(e.Vx[i]*(e.Y[s]-e.Y[i])-e.Vy[i]*(e.X[s]-e.X[i]))/n-e.Rr[i],M=Math.abs(y)<1e-5?Math.PI/2:Math.abs(Math.atan(v/y)),N=(y>0?1:-1)*g*Math.cos(M),e.Rr[s]=2.5*N,e.Rr[i]=e.Rr[i]-2.5*N,f=N*(e.Y[s]-e.Y[i])/n,m=-N*(e.X[s]-e.X[i])/n),e.Vx[s]=u+f,e.Vy[s]=p+m,e.VQx[s]=e.Vx[s]-e.Rq[s],e.VQy[s]=e.Vy[s]+e.Rp[s],e.etat[s]=e.QCQ,e.etat[i]=e.QCQ}i++}return P};this.XMAX=i,this.YMAX=s,this.XMIN=-i,this.YMIN=-s,this.nb_max_clefs=1e4,this.nb_clefs=[];this.nb_clefs[2]=0,this.nb_clefs[1]=0,this.nb_clefs[0]=0,this.evts=[],this.nb_max_sons=50,this.nb_sons=0,this.evts_son=[],this.sorties=[],this.eff_s=[],this.etat=[],this.X0=[],this.Y0=[],this.X=[],this.Y=[],this.Xfin=[],this.Yfin=[],this.RAp=[],this.RAq=[],this.RAr=[],this.RAp0=[],this.RAq0=[],this.RAr0=[],this.RApfin=[],this.RAqfin=[],this.RArfin=[],this.Vx=[],this.Vy=[],this.Rp=[],this.Rq=[],this.Rr=[],this.VQx=[],this.VQy=[],this.etat=[],this.D=.06,this.R=.03,this.RendementChoc=.8,this.deltaclefRot=this.R*Math.PI/10,this.resolution=.01,this.done=!1,this.sorties[0]=0,this.sorties[1]=0,this.sorties[2]=0,this.sorties[3]=7.5,this.sorties[4]=7.5,this.sorties[5]=7.5,this.sorties[6]=16,this.sorties[7]=16,this.sorties[8]=16,this.sorties[9]=33,this.sorties[10]=32,this.sorties[11]=23.5,this.sorties[12]=52,this.sorties[13]=43,this.sorties[14]=31,this.sorties[15]=72,this.sorties[16]=53,this.sorties[17]=35,this.sorties[18]=86,this.sorties[19]=60,this.sorties[20]=38,this.sorties[21]=100,this.sorties[22]=69,this.sorties[23]=44,this.sorties[24]=108,this.sorties[25]=79,this.sorties[26]=53,this.sorties[27]=120,this.sorties[28]=90,this.sorties[29]=60,this.eff_s[0]=-1.5,this.eff_s[1]=0,this.eff_s[2]=1.5,this.eff_s[3]=-1.5,this.eff_s[4]=.5,this.eff_s[5]=1.2,this.eff_s[6]=-1.3,this.eff_s[7]=.7,this.eff_s[8]=1.3,this.eff_s[9]=-.5,this.eff_s[10]=1.3,this.eff_s[11]=1.2,this.eff_s[12]=-.5,this.eff_s[13]=1.3,this.eff_s[14]=1.1,this.eff_s[15]=-.3,this.eff_s[16]=.8,this.eff_s[17]=1.2,this.eff_s[18]=0,this.eff_s[19]=.7,this.eff_s[20]=1.2,this.eff_s[21]=0,this.eff_s[22]=.5,this.eff_s[23]=1.5,this.eff_s[24]=-.6,this.eff_s[25]=.2,this.eff_s[26]=1.5,this.eff_s[27]=-.65,this.eff_s[28]=0,this.eff_s[29]=1.5},I=function t(i,s){var e=this;Object(r.a)(this,t),this.RApInit=[],this.RArInit=[],this.RAqInit=[],this.Xinit=[],this.Yinit=[],this.HBande=.035,this.direction_beta=function(t,i,s){var a,h,n;return n=Math.sqrt((e.Xinit[0]-i)*(e.Xinit[0]-i)+(e.Yinit[0]-s)*(e.Yinit[0]-s)),t*=.06,a=Math.asin(t/n),(h=e.atanjimi(s-e.Yinit[0],i-e.Xinit[0]))-a>Math.PI?h-a-2*Math.PI:h-a<-Math.PI?h-a+2*Math.PI:h-a},this.ToucheBandeX=function(t){for(var i,s,a,h,n,r,o,l,c,u,p,f,m,_=NaN,b=NaN;e.betaQ<0;)e.betaQ=e.betaQ+2*Math.PI;for(;e.betaQ>=2*Math.PI;)e.betaQ=e.betaQ-2*Math.PI;return u=e.betaQ,c=t,b=Math.cos(u),m=Math.sin(u),p=Math.cos(c),f=Math.sin(c),n=((l=Math.sqrt(9e-4-e.er*e.er-e.el*e.el))*p-e.er*f)*b-e.el*m,r=l*f+e.er*p,o=(l*p-e.er*f)*m+e.el*b,_=e.Xinit[0]+n,i=.03+r,e.Yinit[0]+o,a=e.long_billard/2,!(Math.abs(b)<1e-5)&&(u>Math.PI/2&&u<3*Math.PI/2&&(b=-b,_=-_),!((h=(a-_)/b)>1.4)&&(s=.006+.009/1.4*h/p,!(h*f/p+i>e.HBande+s/p)))},this.atanjimi=function(t,i){var s;return Math.abs(i)<1e-6?t>0?Math.PI/2:-Math.PI/2:(s=Math.atan(t/i),i>0?s:t<0?s-Math.PI:s+Math.PI)},this.Quantite=function(){var t,i=0,s=[],a=[];for(t=e.betaQ+Math.PI,i=1;i<e.NBILLES;)s[i]=!1,(e.Xinit[i]-e.Xinit[0])*Math.cos(t)+(e.Yinit[i]-e.Yinit[0])*Math.sin(t)>0&&(a[i]=(e.Yinit[i]-e.Yinit[0])*Math.cos(t)-(e.Xinit[i]-e.Xinit[0])*Math.sin(t),a[i]<.06&&a[i]>-.06&&(s[i]=!0)),i++;e.bille_visee=-1;var h=100;for(i=1;i<e.NBILLES;)s[i]&&(e.Xinit[i]-e.Xinit[0])*(e.Xinit[i]-e.Xinit[0])+(e.Yinit[i]-e.Yinit[0])*(e.Yinit[i]-e.Yinit[0])<h&&(e.bille_visee=i,h=(e.Xinit[i]-e.Xinit[0])*(e.Xinit[i]-e.Xinit[0])+(e.Yinit[i]-e.Yinit[0])*(e.Yinit[i]-e.Yinit[0])),i++;return-1!=e.bille_visee?(e.noba=!0,e.quant=a[e.bille_visee]/2/.03):(e.noba=!1,e.quant=0),e.quant},this.ToucheBandeZ=function(t){for(var i,s,a,h,n,r,o,l,c,u,p,f,m,_=NaN,b=NaN;e.betaQ<0;)e.betaQ=e.betaQ+2*Math.PI;for(;e.betaQ>=2*Math.PI;)e.betaQ=e.betaQ-2*Math.PI;return u=e.betaQ,c=t,m=Math.cos(u),b=Math.sin(u),p=Math.cos(c),f=Math.sin(c),n=((l=Math.sqrt(9e-4-e.er*e.er-e.el*e.el))*p-e.er*f)*m-e.el*b,r=l*f+e.er*p,o=(l*p-e.er*f)*b+e.el*m,e.Xinit[0]+n,i=.03+r,_=e.Yinit[0]+o,a=e.larg_billard/2,!(Math.abs(b)<1e-5)&&(u>Math.PI&&(b=-b,_=-_),!((h=(a-_)/b)>1.4)&&(s=.006+.009/1.4*h/p,!(h*f/p+i>e.HBande+s/p)))},this.AlphaQmin=function(){for(var t=0;e.ToucheBandeZ(t)||e.ToucheBandeX(t)||e.ToucheBille(t);)t+=Math.PI/90;return t},this.ToucheBille=function(t){var i=NaN,s=NaN,a=NaN,h=NaN,n=NaN,r=NaN,o=NaN,l=NaN,c=NaN,u=NaN,p=NaN,f=0,m=t,_=e.betaQ;for(f=1;f<e.NBILLES;){for(i=e.Xinit[0]+.032*Math.cos(_)*Math.cos(m)-e.el*Math.sin(_)-e.er*Math.sin(m)*Math.cos(_),s=.03+.032*Math.sin(m)+e.er*Math.cos(m),a=e.Yinit[0]+.032*Math.sin(_)*Math.cos(m)+e.el*Math.cos(_)-e.er*Math.sin(m)*Math.sin(_),r=e.Xinit[f],o=.03,l=e.Yinit[f],n=0;n<1.4;){if(h=.006+.009/1.4*n,((c=i+n*Math.cos(m)*Math.cos(_))-r)*(c-r)+((u=s+n*Math.sin(m))-o)*(u-o)+((p=a+n*Math.cos(m)*Math.sin(_))-l)*(p-l)<(.03+h+.002)*(.03+h+.002))return!0;n+=.01}f++}return!1};var a=0;for(this.NBILLES=3,this.long_billard=i,this.larg_billard=s,this.Xinit=[],this.Yinit=[],this.RApInit=[],this.RAqInit=[],this.RArInit=[],a=0;a<3;)this.RApInit[a]=0,this.RAqInit[a]=0,this.RArInit[a]=0,a++;this.Xinit[0]=-.71,this.Yinit[0]=-.1775,this.Xinit[1]=-.71,this.Yinit[1]=0,this.Xinit[2]=.71,this.Yinit[2]=0,this.Vqueue=.08,this.el=0,this.er=.012,this.alphaQ=0,this.betaQ=0*Math.PI/4,this.Vqueue=3.19731,this.el=.0056,this.er=.004,this.alphaQ=.033916,this.betaQ=3.28339,this.Xinit[0]=0,this.Yinit[0]=0,this.Xinit[1]=-.051,this.Yinit[1]=.05,this.Xinit[2]=.05,this.Yinit[2]=.05,this.Vqueue=.4,this.el=0,this.er=0,this.alphaQ=.033916,this.betaQ=-7*Math.PI/8},E=function t(i,s,e,a){var h=this;Object(r.a)(this,t),this.mode_jeu=2,this.ralenti=1,this.largeur_bandes=.28,this.change_billard=function(t){if(h.arret_son(),h.myTimer.stop(),1==t){h.taille(280);var i=!1;h.bitmap_Bandes_310.visible=!1,h.bitmap_Billard_310.visible=i;i=!0;h.bitmap_Bandes_280.visible=!0,h.bitmap_Billard_280.visible=i;i=!1;h.bitmap_Bandes_260.visible=!1,h.bitmap_Billard_260.visible=i}else if(2==t){h.taille(260);i=!1;h.bitmap_Bandes_310.visible=!1,h.bitmap_Billard_310.visible=i;i=!1;h.bitmap_Bandes_280.visible=!1,h.bitmap_Billard_280.visible=i;i=!0;h.bitmap_Bandes_260.visible=!0,h.bitmap_Billard_260.visible=i}else if(0==t){h.taille(310);i=!0;h.bitmap_Bandes_310.visible=!0,h.bitmap_Billard_310.visible=i;i=!1;h.bitmap_Bandes_280.visible=!1,h.bitmap_Billard_280.visible=i;i=!1;h.bitmap_Bandes_260.visible=!1,h.bitmap_Billard_260.visible=i}h.ctrl.XC=h.Ech*h.longueur/2,h.ctrl.YC=h.Ech*h.largeur/2,h.Params.long_billard=2*(h.xmax+h.R),h.Params.larg_billard=2*(h.ymax+h.R),null!=h.Simulateur&&(h.Simulateur.XMAX=h.xmax,h.Simulateur.YMAX=h.ymax,h.Simulateur.XMIN=-h.xmax,h.Simulateur.YMIN=-h.ymax),h.tracer_grille(),h.tracer_lines(),h.Placer_billes_hasard(),h.Params.Vqueue=1,h.init_point()},this.arret_son=function(){},this.init_point=function(){h.arret_son(),h.myTimer.stop(),h.afficher_billes(),h.ctrl.aff_parametres(),h.placer_queue(h.dq0),h.queue.visible=!0,h.calculs_faits=!1,h.aff_trajets=!1,h.trajets.graphics.clear(),h.tracer_ligne_visee(),h.ligne_visee.visible=!0},this.update_modejeu=function(t){h.mode_jeu=t,h.arret_son(),0==t&&(h.Vqmax=3.5),1==t&&(h.Vqmax=3.5),2==t&&(h.Vqmax=4.2),3==t&&(h.Vqmax=3.5),4==t&&(h.Vqmax=3.5),5==t&&(h.Vqmax=5.4)},this.Simuler=function(t,i){return h.ralenti=t,h.arret_son(),h.Simulateur.Calcul(i)},this.taille=function(t){h.taille_billard=t,310==t&&(h.longueur=3.12),280==t&&(h.longueur=2.82),260==t&&(h.longueur=2.62),h.xmax=(h.longueur-h.largeur_bandes)/2-.03,h.ymax=(h.longueur-h.largeur_bandes)/4-.03,h.largeur=2*(h.ymax+.03)+h.largeur_bandes};var n=0;this.Ech=e,this.R=.03,this.Rb=36,this.type=0,this.taille(i),this.Params=new I(2*(this.xmax+this.R),2*(this.ymax+this.R));for(this.ombre=[],this.aff_trajets=!1,this.tous_trajets=!0,this.trajet_bille_joueur=!1,this.trajet_bille_visee=!1,this.billes=[],this.bille_visee=1,this.ecl=[],this.dq0=1.5*this.R*this.Ech,this.alphamin=!0,this.Vqmax=3.5,this.Simulateur=new w(this.xmax,this.ymax),this.ind_last_clef=[],n=0;n<3;)this.ind_last_clef[n]=this.Simulateur.nb_max_clefs*n,n++;for(this.calculs_faits=!1,this.ampl_recul_max=.1,this.RAp0=[],this.RAq0=[],this.RAr0=[],n=0;n<3;)this.RAp0[n]=0,this.RAq0[n]=0,this.RAr0[n]=0,n++;this.alphamin=!1,console.log(this)},T=function(){function t(i,s,e,a,h){var n=this;Object(r.a)(this,t),this.drawBallPath=function(t){var i=n.pathData;if(i&&0!=i.length&&(n.pathCueWhite&&n.pathCueWhite.dispose(),n.pathCueYellow&&n.pathCueYellow.dispose(),n.pathTargetBall&&n.pathTargetBall.dispose(),t)){for(var s=[],e=0;e<1e4;e++)i[e]&&s.push(new _.Vector3(R*i[e].X/n.size,n.ballRadius/2,R*i[e].Y/n.size));n.pathCueWhite=_.MeshBuilder.CreateLines("lines",{points:s},n.scene);var a=[],h=[];for(e=1e4;e<2e4;e++)i[e]&&(a.push(new _.Vector3(R*i[e].X/n.size,n.ballRadius/2,R*i[e].Y/n.size)),h.push(new _.Color4(.8,.8,0,1)));n.pathCueYellow=_.MeshBuilder.CreateLines("lines",{points:a,colors:h},n.scene);var r=[],o=[];for(e=2e4;e<3e4;e++)i[e]&&(r.push(new _.Vector3(R*i[e].X/n.size,n.ballRadius/2,R*i[e].Y/n.size)),o.push(new _.Color4(.8,0,0,1)));n.pathTargetBall=_.MeshBuilder.CreateLines("lines",{points:r,colors:o},n.scene)}},this.configCameras=function(){var t=n;t.cameras.arcCam=new _.ArcRotateCamera("Camera-Arc",4.44,1.05,300,_.Vector3.Zero(),t.scene),t.cameras.arcCam.attachControl(t.canvas),t.cameras.arcCam.upperBetaLimit=1.5,t.cameras.arcCam.wheelPrecision=.2,t.cameras.arcCam.upperRadiusLimit=500,t.cameras.arcCam.lowerRadiusLimit=100,t.cameras.topCam=new _.ArcRotateCamera("Camera-Top",-Math.PI/2,0,330,_.Vector3.Zero(),t.scene),t.cameras.topCam.upperBetaLimit=0,t.cameras.topCam.lowerBetaLimit=0,t.cameras.topCam.upperAlphaLimit=-Math.PI/2,t.cameras.topCam.lowerAlphaLimit=-Math.PI/2,t.cameras.topCam.upperRadiusLimit=330,t.cameras.topCam.lowerRadiusLimit=330,t.cameras.topCam.mode=_.Camera.ORTHOGRAPHIC_CAMERA,t.cameras.topCam.orthoTop=130,t.cameras.topCam.orthoBottom=-130,t.cameras.topCam.orthoLeft=-240,t.cameras.topCam.orthoRight=240,t.changeView(t.currentView)},this.loadModels=function(){var t=n,i=n.modelStorePath;_.SceneLoader.ImportMesh("",i,d,t.scene,function(s){t.objects.bat=s[0],t.objects.bat.position.y=50,t.objects.bat.position.z=90,t.objects.batLookatPoint=new _.MeshBuilder.CreateSphere("look-at",{diameter:4},t.scene),t.objects.batLookatPoint.position.y=30,t.objects.batLookatPoint.visibility=!1,_.SceneLoader.ImportMesh("",i,b,t.scene,function(s){t.objects.table=s;var e=!0,a=!1,h=void 0;try{for(var n,r=s[Symbol.iterator]();!(e=(n=r.next()).done);e=!0){var o=n.value;"carpet"===o.name&&(o.material.bumpTexture=new _.Texture(i+"carpet-bump.png",t.scene))}}catch(l){a=!0,h=l}finally{try{e||null==r.return||r.return()}finally{if(a)throw h}}t.configCueBalls(),t.updateBat(t.controlOptions)})})},this.updateControlOptions=function(t){n.controlOptions=t,n.updateBat(t)},this.updateBat=function(t){var i=t.cueLine,s=t.cueAngle,e=t.sideEnglish,a=t.topSpin,h=n.size,r=n.ballRadius,o=n.objects,l=o.bat,c=o.batLookatPoint,u=o.directionLine,p=o.cueBallWhite,f=R*e/h,m=R*a/h;l.position.x=p.position.x-f*Math.sin(i)-m*Math.sin(s)*Math.cos(i),l.position.z=p.position.z+f*Math.cos(i)-m*Math.sin(s)*Math.sin(i),l.position.y=r/2+m*Math.cos(s),l.rotation=new _.Vector3(0,-i,Math.PI/2+s);var b=Object.assign({},l.position);b.y+=40*Math.sin(s),b.x+=40*Math.cos(s)*Math.cos(i),b.z+=40*Math.cos(s)*Math.sin(i),c.position=b,c.lookAt(l.position),u.position.x=p.position.x,u.position.z=p.position.z,u.position.y=r/2,u.rotation.y=Math.PI-i},this.generateReflectionMaterial=function(t,i){for(var s=n.scene,e=new _.ReflectionProbe("satelliteProbe"+t.name,512,s),a=0;a<i.length;a++)e.renderList.push(i[a]);t.material.reflectionTexture=e.cubeTexture,t.material.reflectivityColor=new _.Color3(.2,.2,.2),t.material.reflectionFresnelParameters=new _.FresnelParameters,t.material.reflectionFresnelParameters.bias=0,e.attachToMesh(t)},this.configCueBalls=function(){var t,i,s=n,e=n.modelStorePath,a=n.ballRadius,h=n.objects.table,r=(n.cameras.arcCam,!0),o=!1,l=void 0;try{for(var c,u=h[Symbol.iterator]();!(r=(c=u.next()).done);r=!0){var p=c.value;"carpet"===p.name?t=p:"carpet-side"===p.name&&(i=p)}}catch(y){o=!0,l=y}finally{try{r||null==u.return||u.return()}finally{if(o)throw l}}var f=n.ballPositions,m=f.posCueBallWhite,b=f.posCueBallYellow,d=f.posTargetBall;s.objects.cueBallWhite=_.Mesh.CreateSphere("cue-ball-white",16,a,s.scene),s.objects.cueBallWhite.position.y=a/2,s.objects.cueBallWhite.position.x=m.x,s.objects.cueBallWhite.position.z=m.z;var R=new _.StandardMaterial("redMat",s.scene);R.diffuseTexture=new _.Texture(e+"cueball-white.jpg",s.scene),s.objects.cueBallWhite.material=R,s.objects.cueBallYellow=_.Mesh.CreateSphere("cue-ball-yellow",16,a,s.scene),s.objects.cueBallYellow.position.y=a/2,s.objects.cueBallYellow.position.x=b.x,s.objects.cueBallYellow.position.z=b.z;var V=new _.StandardMaterial("redMat",s.scene);V.diffuseTexture=new _.Texture(e+"cueball-yellow.jpg",s.scene),s.objects.cueBallYellow.material=V,s.objects.targetBall=_.Mesh.CreateSphere("cue-ball-red",16,a,s.scene),s.objects.targetBall.position.y=a/2,s.objects.targetBall.position.x=d.x,s.objects.targetBall.position.z=d.z;var v=new _.StandardMaterial("redMat",s.scene);v.diffuseTexture=new _.Texture(e+"targetball.jpg",s.scene),s.objects.targetBall.material=v,s.generateReflectionMaterial(s.objects.cueBallWhite,[s.objects.cueBallYellow,s.objects.targetBall,s.objects.bat,t,i]),s.generateReflectionMaterial(s.objects.cueBallYellow,[s.objects.cueBallWhite,s.objects.targetBall,s.objects.bat,t,i]),s.generateReflectionMaterial(s.objects.targetBall,[s.objects.cueBallWhite,s.objects.cueBallYellow,s.objects.bat,t,i]),s.objects.ray=new _.Ray,s.objects.rayHelper=new _.RayHelper(s.objects.ray);var M=new _.Vector3(0,0,1);s.objects.rayHelper.attachToMesh(s.objects.batLookatPoint,M)},this.configGrids=function(){for(var t=n,i=[new _.Color4(.7,.7,.7,1),new _.Color4(.7,.7,.7,1)],s=0;s<15;s++){var e=[new _.Vector3(7*-R/16+s*R/16,2,-R/4),new _.Vector3(7*-R/16+s*R/16,2,R/4)];t.grids.push(_.MeshBuilder.CreateLines("lines",{points:e,colors:i},t.scene))}for(s=0;s<7;s++){var a=[new _.Vector3(-R/2,2,3*-R/16+s*R/16),new _.Vector3(R/2,2,3*-R/16+s*R/16)];t.grids.push(_.MeshBuilder.CreateLines("lines",{points:a,colors:i},t.scene))}},this.toggleGrids=function(t){for(var i=n.grids,s=0;s<i.length;s++)i[s].visibility=t},this.initializeScene=function(t,i){var s=n;s.scene=t,s.canvas=i,s.scene.clearColor=new _.Color3(.05,.05,.05),s.objects.directionLine=new _.MeshBuilder.CreateLines("direction-line",{points:[new _.Vector3(0,0,0),new _.Vector3(600,0,0)],colors:[new _.Color4(0,0,.8,1),new _.Color4(0,0,.8,1)]}),new _.HemisphericLight("light",_.Vector3.Up(),t),s.configCameras(),s.loadModels(),s.configGrids(),s.scene.getEngine().runRenderLoop(function(){t&&(t.render(),s.animateBalls())}),i.addEventListener("pointerdown",s.onPointerDown,!1),i.addEventListener("pointerup",s.onPointerUp,!1),i.addEventListener("pointermove",s.onPointerMove,!1)},this.getGroundPosition=function(){var t=n.scene,i=t.pick(t.pointerX,t.pointerY,function(t){return"carpet"==t.name});return i.hit?i.pickedPoint:null},this.onPointerDown=function(t){var i=n,s=n.scene,e=n.canvas;if(0===t.button){var a=s.pick(s.pointerX,s.pointerY,function(t){return"cue-ball-white"===t.name||"cue-ball-yellow"===t.name||"cue-ball-red"===t.name});a.hit&&(i.currentMesh=a.pickedMesh,i.startingPoint=i.getGroundPosition(t),i.startingPoint&&setTimeout(function(){i.cameras.arcCam.detachControl(e)},0))}},this.onPointerUp=function(){var t=n,i=n.startingPoint,s=n.canvas;if(i)return t.cameras.arcCam.attachControl(s,!0),t.startingPoint=null,void(t.currentMesh=null)},this.onPointerMove=function(t){var i=n,s=n.startingPoint,e=n.currentMesh;if(s){var a=i.getGroundPosition(t);a&&(e.position=a,e.position.y=i.ballRadius/2,s=a,i.updateBat(i.controlOptions))}},this.moveAndRotateBall=function(t,i,s){var e,a=-1,h=n;for(e=1e4*s;e<1e4*(s+1)&&h.pathData[e];e++)h.pathData[e].time<i-h.t0&&(a=e);if(a>=0){if(a==e-1)return!1;var r=h.pathData[a];t.position.x=R*r.X/h.size,t.position.z=R*r.Y/h.size;var o=h.pathData[a].RAp,l=h.pathData[a].RAq,c=h.pathData[a].RAr,u=(o-h.RAp0[s])/.03,p=(l-h.RAq0[s])/.03,f=(c-h.RAr0[s])/.03;return h.RAp0[s]=o,h.RAq0[s]=l,h.RAr0[s]=c,t.rotate(_.Axis.X,-u,_.Space.WORLD),t.rotate(_.Axis.Y,-f,_.Space.WORLD),t.rotate(_.Axis.Z,-p,_.Space.WORLD),!0}},this.animateBalls=function(){var t=n,i=n.objects,s=i.cueBallWhite,e=i.cueBallYellow,a=i.targetBall;if(t.pathData&&0!=t.pathData.length&&void 0!=t.t0){var h=(new Date).getTime()/1e3,r=n.moveAndRotateBall(s,h,0),o=n.moveAndRotateBall(e,h,1),l=n.moveAndRotateBall(a,h,2);console.log(r,o,l),0==r&&0==o&&0==l&&(t.pathData=[])}},this.playSimulation=function(){var t=n,i=(n.initBallPosition,n.controlOptions),s=n.objects,e=s.cueBallWhite,a=s.cueBallYellow,h=s.targetBall,r=n.billard.Simuler(1,{Xinit:[t.size*e.position.x/R,t.size*a.position.x/R,t.size*h.position.x/R],Yinit:[t.size*e.position.z/R,t.size*a.position.z/R,t.size*h.position.z/R],RApInit:[0,0,0],RAqInit:[0,0,0],RArInit:[0,0,0],el:i.sideEnglish,er:i.topSpin,alphaQ:i.cueAngle,betaQ:i.cueLine,Vqueue:i.speed});console.log(r),r&&0!=r.length&&(n.pathData=r,n.t0=(new Date).getTime()/1e3)},this.scene=void 0,this.canvas=void 0,this.size=i,this.ballRadius=400*V/(100*this.size),this.modelStorePath=s,this.initBallPosition=a,this.ballPositions={posCueBallWhite:{x:R*a.posCueBallWhite.x/i,z:R*a.posCueBallWhite.z/i},posCueBallYellow:{x:R*a.posCueBallYellow.x/i,z:R*a.posCueBallYellow.z/i},posTargetBall:{x:R*a.posTargetBall.x/i,z:R*a.posTargetBall.z/i}},this.currentView=e,this.cameras={arcCam:void 0,topCam:void 0},this.objects={table:void 0,bat:void 0,cueBallWhite:void 0,cueBallYellow:void 0,targetBall:void 0,batContactLine:void 0,batLookatPoint:void 0,directionLine:void 0},this.controlOptions=h,this.grids=[],this.pathCueWhite=void 0,this.pathCueYellow=void 0,this.pathTargetBall=void 0,this.billard=new E(310,void 0,300),this.timerCount=0,this.RAp0=[0,0,0],this.RAq0=[0,0,0],this.RAr0=[0,0,0]}return Object(o.a)(t,[{key:"changeView",value:function(t){"2d"===t?(this.scene.activeCamera=this.cameras.topCam,this.cameras.arcCam.detachControl(this.canvas),this.cameras.topCam.attachControl(this.canvas)):(this.scene.activeCamera=this.cameras.arcCam,this.cameras.arcCam.attachControl(this.canvas),this.cameras.topCam.detachControl(this.canvas))}}]),t}(),j=function(t){function i(t){var s;return Object(r.a)(this,i),(s=Object(l.a)(this,Object(c.a)(i).call(this,t))).meshPicked=function(t){},s.drawBallPath=function(t){s.board.drawBallPath(t)},s.onSceneMount=function(t){var i=t.canvas,e=t.scene;s.board.initializeScene(e,i)},s.toggleGrids=function(t){s.board.toggleGrids(t)},s.playSimulation=function(){s.board.playSimulation()},s.updateControlOptions=function(t){s.board.updateControlOptions(t)},s.componentDidMount=function(){},s.state={showPath:!1},s.board=new T(s.props.size,s.props.modelStorePath,s.props.currentView,{posCueBallWhite:{x:s.props.posCueBallWhite.x,z:s.props.posCueBallWhite.z},posCueBallYellow:{x:s.props.posCueBallYellow.x,z:s.props.posCueBallYellow.z},posTargetBall:{x:s.props.posTargetBall.x,z:s.props.posTargetBall.z}},{cueLine:s.props.cueLine,cueAngle:s.props.cueAngle,sideEnglish:s.props.sideEnglish,topSpin:s.props.topSpin,speed:s.props.speed}),s.simulatorDom=new a.a.createRef,s}return Object(u.a)(i,t),Object(o.a)(i,[{key:"changeView",value:function(t){this.board.changeView(t)}},{key:"render",value:function(){return a.a.createElement(m.a,{canvasId:"carom-simulator-canvas"},a.a.createElement(m.b,{onMeshPicked:this.meshPicked,onSceneMount:this.onSceneMount}))}}]),i}(a.a.Component),Q=s(5),B=s(6),O=(s(32),function(t){function i(t){var s;return Object(r.a)(this,i),(s=Object(l.a)(this,Object(c.a)(i).call(this,t))).componentWillReceiveProps=function(t){var i=t.value;s.setState({value:i})},s.updateValue=function(t){s.setState({value:t}),s.props.onUpdate(s.props.itemKey,t)},s.onChangeValue=function(t){var i=t.target.value;s.updateValue(i)},s.onMinusPressed=function(){var t=s.state.value,i=s.props,e=i.min,a=i.step;void 0===a&&(a=.1),(t=(10*t-(a*=10))/10)<e&&(t=e),s.updateValue(t)},s.onPlusPressed=function(){var t=s.state.value,i=s.props,e=i.max,a=i.step;void 0===a&&(a=.1),(t=(10*t+(a*=10))/10)>e&&(t=e),s.updateValue(t)},s.state={value:s.props.value?s.props.value:0},s}return Object(u.a)(i,t),Object(o.a)(i,[{key:"render",value:function(){var t=this.state.value,i=this.props,s=i.containerClass,e=i.label,h=i.min,n=i.max,r=i.unitDom,o=i.step;return void 0===o&&(o=.1),a.a.createElement("div",{className:s},a.a.createElement("div",{style:{display:"flex"}},a.a.createElement(Q.a,{icon:B.d,className:"btn-change-value",onClick:this.onMinusPressed}),a.a.createElement("span",{style:{flex:1,textAlign:"center"}},e,a.a.createElement("span",null," : ",t,r)),a.a.createElement(Q.a,{icon:B.f,className:"btn-change-value",onClick:this.onPlusPressed})),a.a.createElement("input",{type:"range",min:h,max:n,value:t,className:"slider",step:o,onChange:this.onChangeValue}))}}]),i}(a.a.Component)),L=(s(33),function(t){function i(t){var s;return Object(r.a)(this,i),(s=Object(l.a)(this,Object(c.a)(i).call(this,t))).onInputSliderUpdated=function(t,i){var e=Object.assign({},s.state);e[t]=parseFloat(i),s.setState(e);var a=Object.assign({},e);a.cueLine=Math.PI*e.cueLine/180,a.cueAngle=Math.PI*e.cueAngle/180,a.sideEnglish/=1e3,a.topSpin/=1e3,a.speed/=100,s.props.onControlOptionsUpdated(a)},s.state={cueLine:Math.round(1800*s.props.cueLine/Math.PI)/10,cueAngle:Math.round(1800*s.props.cueAngle/Math.PI)/10,sideEnglish:Math.round(1e4*s.props.sideEnglish)/10,topSpin:Math.round(1e4*s.props.topSpin)/10,speed:Math.round(100*s.props.speed)},s}return Object(u.a)(i,t),Object(o.a)(i,[{key:"render",value:function(){var t=this,i=this.state,s=i.cueLine,e=i.cueAngle,h=i.sideEnglish,n=i.topSpin,r=i.speed,o=this.props,l=o.showGrid,c=o.showPath,u="toggle-btn",p="toggle-btn";return!0===l&&(u+=" active"),!0===c&&(p+=" active"),a.a.createElement("div",null,a.a.createElement("div",{className:"common-controller-container"},a.a.createElement(Q.a,{className:u,icon:B.h,onClick:function(){t.props.onToggleShowGrid(!l)}}),a.a.createElement(Q.a,{className:p,icon:B.b,onClick:function(){t.props.onToggleShowPath(!c)}}),a.a.createElement(Q.a,{className:"toggle-btn",icon:B.i})),a.a.createElement("div",null,a.a.createElement(O,{label:"Cue Line",containerClass:"slider-container",min:0,max:360,value:s,unitDom:a.a.createElement("sup",null,"o"),itemKey:"cueLine",onUpdate:this.onInputSliderUpdated}),a.a.createElement(O,{label:"Cue Angle",containerClass:"slider-container",min:2,max:89,value:e,unitDom:a.a.createElement("sup",null,"o"),itemKey:"cueAngle",onUpdate:this.onInputSliderUpdated}),a.a.createElement("br",null),a.a.createElement(O,{label:"Side English",containerClass:"slider-container",min:-15.1,max:15.1,value:h,unitDom:a.a.createElement("span",null,"mm"),itemKey:"sideEnglish",onUpdate:this.onInputSliderUpdated}),a.a.createElement(O,{label:"Top Spin",containerClass:"slider-container",min:-15.1,max:15.1,value:n,unitDom:a.a.createElement("span",null,"mm"),itemKey:"topSpin",onUpdate:this.onInputSliderUpdated}),a.a.createElement(O,{label:"Speed",containerClass:"slider-container",min:0,max:450,value:r,step:1,unitDom:a.a.createElement("span",null,"cm/s"),itemKey:"speed",onUpdate:this.onInputSliderUpdated})),a.a.createElement("div",{className:"play-controller-container"},a.a.createElement(Q.a,{className:"play-controller",icon:B.a}),a.a.createElement(Q.a,{className:"play-controller",icon:B.g}),a.a.createElement(Q.a,{className:"play-controller",icon:B.e,onClick:this.props.onPlayPressed}),a.a.createElement(Q.a,{className:"play-controller",icon:B.c})))}}]),i}(a.a.Component)),k=(a.a.Component,s(14),function(t){function i(t){var s;return Object(r.a)(this,i),(s=Object(l.a)(this,Object(c.a)(i).call(this,t))).viewSelectorItemClicked=s.viewSelectorItemClicked.bind(Object(p.a)(s)),s}return Object(u.a)(i,t),Object(o.a)(i,[{key:"viewSelectorItemClicked",value:function(t){"function"===typeof this.props.viewSelectorItemClicked&&this.props.viewSelectorItemClicked(t)}},{key:"render",value:function(){var t=this,i="view-selector-item",s="view-selector-item";return"2d"===this.props.currentView?i+=" active":s+=" active",a.a.createElement("div",{className:"view-selector"},a.a.createElement("span",{className:i,onClick:function(){t.viewSelectorItemClicked("2d")}},"2D"),a.a.createElement("span",{className:s,onClick:function(){t.viewSelectorItemClicked("3d")}},"3D"))}}]),i}(e.Component)),z="pooltable.babylon",D="bat.babylon",U=404,G=5.715,W=function(){function t(i,s){Object(r.a)(this,t),this.HBande=.035;var e=0,a=0,h=!1;for(this.NBILLES=16,this.long_billard=i,this.larg_billard=s,this.Xinit=[],this.Yinit=[],this.RApInit=[],this.RAqInit=[],this.RArInit=[],this.empocheeInit=[],e=0;e<this.NBILLES;)this.RApInit[e]=0,this.RAqInit[e]=0,this.RArInit[e]=0,e++;for(this.Xinit[0]=0,this.Yinit[0]=-s/4,this.empocheeInit[0]=!1,e=1;e<16;){do{for(this.Xinit[e]=.1*(e-8),this.Yinit[e]=0,h=!0,a=0;a<e&&h;)(this.Xinit[e]-this.Xinit[a])*(this.Xinit[e]-this.Xinit[a])+(this.Yinit[e]-this.Yinit[a])*(this.Yinit[e]-this.Yinit[a])<.004&&(h=!1),a++;this.empocheeInit[e]=!1}while(!h);e++}this.Vqueue=1.5,this.el=0,this.er=0,this.alphaQ=.033916,this.betaQ=-7*Math.PI/8}return Object(o.a)(t,[{key:"direction_beta",value:function(t,i,s){var e,a,h;return h=Math.sqrt((this.Xinit[0]-i)*(this.Xinit[0]-i)+(this.Yinit[0]-s)*(this.Yinit[0]-s)),t*=.06,e=Math.asin(t/h),(a=this.atanjimi(s-this.Yinit[0],i-this.Xinit[0]))-e>Math.PI?a-e-2*Math.PI:a-e<-Math.PI?a-e+2*Math.PI:a-e}},{key:"ToucheBandeX",value:function(t){for(var i,s,e,a,h,n,r,o,l,c,u,p,f,m=NaN,_=NaN;this.betaQ<0;)this.betaQ=this.betaQ+2*Math.PI;for(;this.betaQ>=2*Math.PI;)this.betaQ=this.betaQ-2*Math.PI;return c=this.betaQ,l=t,_=Math.cos(c),f=Math.sin(c),u=Math.cos(l),p=Math.sin(l),h=((o=Math.sqrt(9e-4-this.er*this.er-this.el*this.el))*u-this.er*p)*_-this.el*f,n=o*p+this.er*u,r=(o*u-this.er*p)*f+this.el*_,m=this.Xinit[0]+h,i=.03+n,this.Yinit[0]+r,e=this.long_billard/2,!(Math.abs(_)<1e-5)&&(c>Math.PI/2&&c<3*Math.PI/2&&(_=-_,m=-m),!((a=(e-m)/_)>1.4)&&(s=.006+.009/1.4*a/u,!(a*p/u+i>this.HBande+s/u)))}},{key:"atanjimi",value:function(t,i){var s;return Math.abs(i)<1e-6?t>0?Math.PI/2:-Math.PI/2:(s=Math.atan(t/i),i>0?s:t<0?s-Math.PI:s+Math.PI)}},{key:"Quantite",value:function(){var t,i=0,s=[],e=[];for(t=this.betaQ+Math.PI,i=1;i<this.NBILLES;)s[i]=!1,this.empocheeInit[i]||(this.Xinit[i]-this.Xinit[0])*Math.cos(t)+(this.Yinit[i]-this.Yinit[0])*Math.sin(t)>0&&(e[i]=(this.Yinit[i]-this.Yinit[0])*Math.cos(t)-(this.Xinit[i]-this.Xinit[0])*Math.sin(t),e[i]<.06&&e[i]>-.06&&(s[i]=!0)),i++;this.bille_visee=-1;var a=100;for(i=1;i<this.NBILLES;)s[i]&&(this.Xinit[i]-this.Xinit[0])*(this.Xinit[i]-this.Xinit[0])+(this.Yinit[i]-this.Yinit[0])*(this.Yinit[i]-this.Yinit[0])<a&&(this.bille_visee=i,a=(this.Xinit[i]-this.Xinit[0])*(this.Xinit[i]-this.Xinit[0])+(this.Yinit[i]-this.Yinit[0])*(this.Yinit[i]-this.Yinit[0])),i++;return-1!=this.bille_visee?(this.noba=!0,this.quant=e[this.bille_visee]/2/.03):(this.noba=!1,this.quant=0),this.quant}},{key:"ToucheBille",value:function(t){var i=NaN,s=NaN,e=NaN,a=NaN,h=NaN,n=NaN,r=NaN,o=NaN,l=NaN,c=NaN,u=NaN,p=0,f=t,m=this.betaQ;for(p=1;p<this.NBILLES;){for(i=this.Xinit[0]+.032*Math.cos(m)*Math.cos(f)-this.el*Math.sin(m)-this.er*Math.sin(f)*Math.cos(m),s=.03+.032*Math.sin(f)+this.er*Math.cos(f),e=this.Yinit[0]+.032*Math.sin(m)*Math.cos(f)+this.el*Math.cos(m)-this.er*Math.sin(f)*Math.sin(m),n=this.Xinit[p],r=.03,o=this.Yinit[p],h=0;h<1.4;){if(a=.006+.009/1.4*h,((l=i+h*Math.cos(f)*Math.cos(m))-n)*(l-n)+((c=s+h*Math.sin(f))-r)*(c-r)+((u=e+h*Math.cos(f)*Math.sin(m))-o)*(u-o)<(.03+a+.002)*(.03+a+.002))return!0;h+=.01}p++}return!1}},{key:"ToucheBandeZ",value:function(t){for(var i,s,e,a,h,n,r,o,l,c,u,p,f,m=NaN,_=NaN;this.betaQ<0;)this.betaQ=this.betaQ+2*Math.PI;for(;this.betaQ>=2*Math.PI;)this.betaQ=this.betaQ-2*Math.PI;return c=this.betaQ,l=t,f=Math.cos(c),_=Math.sin(c),u=Math.cos(l),p=Math.sin(l),h=((o=Math.sqrt(9e-4-this.er*this.er-this.el*this.el))*u-this.er*p)*f-this.el*_,n=o*p+this.er*u,r=(o*u-this.er*p)*_+this.el*f,this.Xinit[0]+h,i=.03+n,m=this.Yinit[0]+r,e=this.larg_billard/2,!(Math.abs(_)<1e-5)&&(c>Math.PI&&(_=-_,m=-m),!((a=(e-m)/_)>1.4)&&(s=.006+.009/1.4*a/u,!(a*p/u+i>this.HBande+s/u)))}},{key:"AlphaQmin",value:function(){for(var t=0;this.ToucheBandeZ(t)||this.ToucheBandeX(t)||this.ToucheBille(t);)t+=Math.PI/90;return t}}]),t}(),H=function t(){Object(r.a)(this,t),this.played=!1},F=function t(){Object(r.a)(this,t)},K=function(){function t(i,s){Object(r.a)(this,t),this.b1=-.96912,this.b3=.76856,this.RSG=1,this.RTROU=.0533,this.fgpas=.00225,this.frpas=63e-6,this.EPSILON_COIN=.8,this.XTROU2=0,this.QCQ=2,this.Rfppas=135e-6,this.f1=.375,this.f2=.61,this.fbille=.075,this.Rfp=.225,this.pas=5e-4,this.fp1=.3,this.ARRET=0,this.angle_poche_coin=.890118,this.fg=3.75,this.YTROU=.652,this.angle_poche_centrale=-.244346,this.fr=.09,this.XC=-1.1867,this.EMPOCHEE=4,this.XE=-.0633,this.XF=-.03333,this.XB=-1.2467,this.XA=-1.27,this.delta_fgpas=.00786,this.YB=.57055,this.YC=.635,this.YF=.635,this.YA=.55167,this.YTROU2=.6883,this.YE=.635,this.XTROU=-1.2867,this.EPSILON=.86,this.TSP=3,this.a3=4.0108,this.a1=-1.235,this.a2=-.80978;var e=0;for(this.XD=this.XC-.03*Math.sin(39*Math.PI/180),this.YD=this.YC-.03*Math.cos(39*Math.PI/180),this.b2=this.YD-this.a2*this.XD,this.XMAX=i,this.YMAX=s,this.XMIN=-i,this.YMIN=-s,this.nb_max_clefs=1e4,this.nb_clefs=[],e=0;e<16;)this.nb_clefs[e]=0,e++;this.evts=[],this.nb_max_sons=100,this.nb_sons=0,this.evts_son=[],this.sorties=[],this.eff_s=[],this.etat=[],this.X0=[],this.Y0=[],this.X=[],this.Y=[],this.Xfin=[],this.Yfin=[],this.RAp=[],this.RAq=[],this.RAr=[],this.RAp0=[],this.RAq0=[],this.RAr0=[],this.RApfin=[],this.RAqfin=[],this.RArfin=[],this.empochee_fin=[],this.Vx=[],this.Vy=[],this.Rp=[],this.Rq=[],this.Rr=[],this.VQx=[],this.VQy=[],this.etat=[],this.time_empochee=[],this.immobile=[],this.date_arret=[],this.D=.06,this.R=.03,this.RendementChoc=.8,this.deltaclefRot=this.R*Math.PI/10,this.resolution=.01,this.done=!1,this.sorties[0]=0,this.sorties[1]=0,this.sorties[2]=0,this.sorties[3]=7.5,this.sorties[4]=7.5,this.sorties[5]=7.5,this.sorties[6]=16,this.sorties[7]=16,this.sorties[8]=16,this.sorties[9]=33,this.sorties[10]=32,this.sorties[11]=23.5,this.sorties[12]=52,this.sorties[13]=43,this.sorties[14]=31,this.sorties[15]=72,this.sorties[16]=53,this.sorties[17]=35,this.sorties[18]=86,this.sorties[19]=60,this.sorties[20]=38,this.sorties[21]=100,this.sorties[22]=69,this.sorties[23]=44,this.sorties[24]=108,this.sorties[25]=79,this.sorties[26]=53,this.sorties[27]=120,this.sorties[28]=90,this.sorties[29]=60,this.eff_s[0]=-1.5,this.eff_s[1]=0,this.eff_s[2]=1.5,this.eff_s[3]=-1.5,this.eff_s[4]=.5,this.eff_s[5]=1.2,this.eff_s[6]=-1.3,this.eff_s[7]=.7,this.eff_s[8]=1.3,this.eff_s[9]=-.5,this.eff_s[10]=1.3,this.eff_s[11]=1.2,this.eff_s[12]=-.5,this.eff_s[13]=1.3,this.eff_s[14]=1.1,this.eff_s[15]=-.3,this.eff_s[16]=.8,this.eff_s[17]=1.2,this.eff_s[18]=0,this.eff_s[19]=.7,this.eff_s[20]=1.2,this.eff_s[21]=0,this.eff_s[22]=.5,this.eff_s[23]=1.5,this.eff_s[24]=-.6,this.eff_s[25]=.2,this.eff_s[26]=1.5,this.eff_s[27]=-.65,this.eff_s[28]=0,this.eff_s[29]=1.5}return Object(o.a)(t,[{key:"choc_bande",value:function(t){var i=NaN;return!(this.X[t]>this.XMIN&&this.X[t]<this.XMAX&&this.Y[t]>this.YMIN&&this.Y[t]<this.YMAX)&&(!(this.X[t]<this.XMIN&&this.Vx[t]>0)&&(!(this.X[t]>this.XMAX&&this.Vx[t]<0)&&(!(this.Y[t]>this.YMAX&&this.Vy[t]<0)&&(!(this.Y[t]<this.YMIN&&this.Vy[t]>0)&&(this.etat[t]==this.RSG?(this.Rp[t]=-this.Vy[t],this.Rq[t]=this.Vx[t]):this.etat[t]==this.QCQ&&(this.Rp[t]=-this.Vy[t]+this.VQy[t],this.Rq[t]=this.Vx[t]-this.VQx[t]),this.init_pars(t),this.VMz=this.VT-this.VRr,this.VN0=-this.VN,this.VN=this.VN*-this.EPSILON,this.deltaVN=this.VN0+this.VN,this.intens=this.VN0/20,this.intens>1&&(this.intens=1),this.beta_adh=2/7*Math.sqrt(this.VMz*this.VMz+this.VRq*this.VRq),this.beta_gliss=this.f1*this.deltaVN,Math.abs(this.VMz)<1e-5?this.alpha_bande=Math.PI/2:this.alpha_bande=Math.abs(Math.atan(this.VRq/this.VMz)),i=Math.abs(this.fp1*this.deltaVN),Math.abs(this.VRp)<i?this.VRp=0:this.VRp>0?this.VRp=this.VRp-i:this.VRp=this.VRp+i,i=Math.abs(this.f2*this.deltaVN),this.VRq=this.VRq+i,this.choc_adh(t),this.recup_pars(t),this.VQx[t]=this.Vx[t]-this.Rq[t],this.VQy[t]=this.Vy[t]+this.Rp[t],this.etat[t]=this.QCQ,!0)))))}},{key:"mise_a_jour",value:function(t){var i=NaN,s=NaN,e=NaN,a=NaN,h=NaN;if(this.etat[t]==this.RSG){if((i=Math.sqrt(this.Vx[t]*this.Vx[t]+this.Vy[t]*this.Vy[t]))<this.frpas){var n=0;this.Vy[t]=0,this.Vx[t]=n;n=0;if(this.Rq[t]=0,this.Rp[t]=n,Math.abs(this.Rr[t])<this.Rfppas)return this.date_arret[t]=this.date*this.pas,this.etat[t]=this.ARRET,this.Rr[t]=0,this.add_clef(t),!0;this.etat[t]=this.TSP}this.etat[t]!=this.TSP&&(s=1-this.frpas/i,this.Vx[t]=this.Vx[t]*s,this.Vy[t]=this.Vy[t]*s,this.Rp[t]=-this.Vy[t],this.Rq[t]=this.Vx[t]),Math.abs(this.Rr[t])<this.Rfppas?this.Rr[t]=0:this.Rr[t]>0?this.Rr[t]=this.Rr[t]-this.Rfppas:this.Rr[t]=this.Rr[t]+this.Rfppas}if(this.etat[t]==this.QCQ&&((e=Math.sqrt(this.VQx[t]*this.VQx[t]+this.VQy[t]*this.VQy[t]))<this.delta_fgpas?this.etat[t]=this.RSG:(a=-this.fgpas*this.VQx[t]/e,h=-this.fgpas*this.VQy[t]/e,this.Vx[t]=this.Vx[t]+a,this.Vy[t]=this.Vy[t]+h,s=1-this.delta_fgpas/e,this.VQx[t]=this.VQx[t]*s,this.VQy[t]=this.VQy[t]*s),this.Rp[t]=-this.Vy[t]+this.VQy[t],this.Rq[t]=this.Vx[t]-this.VQx[t],Math.abs(this.Rr[t])<this.Rfppas?this.Rr[t]=0:this.Rr[t]>0?this.Rr[t]=this.Rr[t]-this.Rfppas:this.Rr[t]=this.Rr[t]+this.Rfppas),this.etat[t]==this.TSP){n=0;this.Vy[t]=0,this.Vx[t]=n;n=0;if(this.Rq[t]=0,this.Rp[t]=n,Math.abs(this.Rr[t])<this.Rfppas)return this.Rr[t]=0,this.date_arret[t]=this.date*this.pas,this.etat[t]=this.ARRET,!0;this.Rr[t]>0?this.Rr[t]=this.Rr[t]-2*this.Rfppas:this.Rr[t]=this.Rr[t]+2*this.Rfppas}return this.X[t]=this.X[t]+this.Vx[t]*this.pas,this.Y[t]=this.Y[t]+this.Vy[t]*this.pas,this.RAp[t]=this.RAp[t]+this.Rp[t]*this.pas,this.RAq[t]=this.RAq[t]+this.Rq[t]*this.pas,this.RAr[t]=this.RAr[t]+this.Rr[t]*this.pas,!1}},{key:"choc_adh",value:function(t){var i,s,e=NaN,a=NaN,h=NaN,n=NaN,r=NaN,o=0;e=Math.abs(this.VT)<1e-5?90:180/Math.PI*Math.atan(this.VN0/this.VT),this.effet=100*this.R/2*this.VRr/Math.sqrt(this.VN0*this.VN0+this.VT*this.VT),this.effet<=-1.5?this.effet=-1.499:this.effet>1.5&&(this.effet=1.499),Math.abs(this.VT)<1e-5?a=this.effet>0?this.sorties[28]+(this.sorties[29]-this.sorties[28])*(this.effet/1.5):this.sorties[27]+(this.sorties[28]-this.sorties[27])*(this.effet+1.5)/1.5:(e=180/Math.PI*Math.atan(this.VN0/this.VT),o=parseInt(e/10),a=(h=this.effet>0?this.sorties[3*o+1]+(this.sorties[3*o+2]-this.sorties[3*o+1])*(this.effet/1.5):this.sorties[3*o+0]+(this.sorties[3*o+1]-this.sorties[3*o+0])*(this.effet+1.5)/1.5)+((this.effet>0?this.sorties[3*(o+1)+1]+(this.sorties[3*(o+1)+2]-this.sorties[3*(o+1)+1])*(this.effet/1.5):this.sorties[3*(o+1)+0]+(this.sorties[3*(o+1)+1]-this.sorties[3*(o+1)+0])*(this.effet+1.5)/1.5)-h)/10*(e-10*o)),Math.abs(a-90)<1e-5?this.VT=0:this.VT=a<90?this.VN/Math.tan(a/180*Math.PI):-this.VN*Math.tan((a-90)/180*Math.PI),Math.abs(this.VT)<1e-5?this.effet>0?this.e_s=this.eff_s[28]+(this.eff_s[29]-this.eff_s[28])*(this.effet/1.5):this.e_s=this.eff_s[27]+(this.eff_s[28]-this.eff_s[27])*(this.effet+1.5)/1.5:(this.effet>0?(n=this.eff_s[3*o+1]+(this.eff_s[3*o+2]-this.eff_s[3*o+1])*(this.effet/1.5),r=this.eff_s[3*(o+1)+1]+(this.eff_s[3*(o+1)+2]-this.eff_s[3*(o+1)+1])*(this.effet/1.5)):(n=this.eff_s[3*o+0]+(this.eff_s[3*o+1]-this.eff_s[3*o+0])*(this.effet+1.5)/1.5,r=this.eff_s[3*(o+1)+0]+(this.eff_s[3*(o+1)+1]-this.eff_s[3*(o+1)+0])*(this.effet+1.5)/1.5),this.e_s=n+(r-n)/10*(e-10*o)),s=(5*this.VN+2*this.VRq)/7,i=(5*this.VT-2*this.VRp)/7,this.VRr=.02*this.e_s/this.R*Math.sqrt(s*s+i*i)}},{key:"recup_pars",value:function(t){this.X[t]>this.XMAX&&this.Vx[t]>0&&(this.Vx[t]=-this.VN,this.Rq[t]=-this.VRq,this.Vy[t]>0?(this.Vy[t]=this.VT,this.Rp[t]=this.VRp,this.Rr[t]=-this.VRr):(this.Vy[t]=-this.VT,this.Rp[t]=-this.VRp,this.Rr[t]=this.VRr)),this.X[t]<this.XMIN&&this.Vx[t]<0&&(this.Vx[t]=this.VN,this.Rq[t]=this.VRq,this.Vy[t]>0?(this.Vy[t]=this.VT,this.Rp[t]=this.VRp,this.Rr[t]=this.VRr):(this.Vy[t]=-this.VT,this.Rp[t]=-this.VRp,this.Rr[t]=-this.VRr)),this.Y[t]<this.YMIN&&this.Vy[t]<0&&(this.Vy[t]=this.VN,this.Rp[t]=-this.VRq,this.Vx[t]>0?(this.Vx[t]=this.VT,this.Rq[t]=-this.VRp,this.Rr[t]=-this.VRr):(this.Vx[t]=-this.VT,this.Rq[t]=this.VRp,this.Rr[t]=this.VRr)),this.Y[t]>this.YMAX&&this.Vy[t]>0&&(this.Vy[t]=-this.VN,this.Rp[t]=this.VRq,this.Vx[t]>0?(this.Vx[t]=this.VT,this.Rq[t]=-this.VRp,this.Rr[t]=this.VRr):(this.Vx[t]=-this.VT,this.Rq[t]=this.VRp,this.Rr[t]=-this.VRr))}},{key:"Symetrise_Params",value:function(t,i){1!=i&&4!=i||(this.X[t]=-this.X[t],this.Vx[t]=-this.Vx[t],this.VQx[t]=-this.VQx[t]),3!=i&&4!=i||(this.Y[t]=-this.Y[t],this.Vy[t]=-this.Vy[t],this.VQy[t]=-this.VQy[t])}},{key:"choc_gliss",value:function(t){this.VMz>0?(this.VT=this.VT-this.beta_gliss*Math.cos(this.alpha_bande),this.VRr=this.VRr+2.5*this.beta_gliss*Math.cos(this.alpha_bande)):(this.VT=this.VT+this.beta_gliss*Math.cos(this.alpha_bande),this.VRr=this.VRr-2.5*this.beta_gliss*Math.cos(this.alpha_bande))}},{key:"choc_billes",value:function(t){var i=0,s=0,e=!1,a=NaN,h=NaN,n=0,r=NaN,o=NaN,l=NaN,c=NaN,u=NaN,p=NaN,f=NaN,m=NaN,_=NaN,b=NaN,d=NaN,R=NaN,V=NaN,v=NaN,M=NaN,y=NaN,g=NaN,N=NaN,P=!1,x=[];for(i=0;i<16;)x[i]=!1,i++;for(i=0;i<16;){if(this.etat[i]!=this.EMPOCHEE&&!x[i]){for(e=!1,n=i+1;n<16&&!e;){if(this.etat[n]!=this.EMPOCHEE&&(a=(this.X[i]-this.X[n])*(this.X[i]-this.X[n])+(this.Y[i]-this.Y[n])*(this.Y[i]-this.Y[n]))<this.D*this.D&&(this.etat[i]!=this.ARRET||this.etat[n]!=this.ARRET)&&(this.Vx[i]-this.Vx[n])*(this.X[n]-this.X[i])+(this.Vy[i]-this.Vy[n])*(this.Y[n]-this.Y[i])>0){e=!0;var q=!0;x[n]=!0,x[i]=q,s=n,P=!0,t[0]=i,t[1]=s}n++}if(e){q=!1;this.immobile[s]=!1,this.immobile[i]=q,this.add_clef(i),this.add_clef(s),x[i]=!0,this.etat[i]==this.RSG&&(this.Rp[i]=-this.Vy[i],this.Rq[i]=this.Vx[i]),this.etat[i]==this.QCQ&&(this.Rp[i]=-this.Vy[i]+this.VQy[i],this.Rq[i]=this.Vx[i]-this.VQx[i]),this.etat[i]==this.ARRET&&(this.Rp[i]=0,this.Rq[i]=0),x[s]=!0,this.etat[s]==this.RSG&&(this.Rp[s]=-this.Vy[s],this.Rq[s]=this.Vx[s]),this.etat[s]==this.QCQ&&(this.Rp[s]=-this.Vy[s]+this.VQy[s],this.Rq[s]=this.Vx[s]-this.VQx[s]),this.etat[s]==this.ARRET&&(this.Rp[s]=0,this.Rq[s]=0),r=(_=this.Vx[i]*(this.X[s]-this.X[i])+this.Vy[i]*(this.Y[s]-this.Y[i]))*(this.X[s]-this.X[i])/a,o=_*(this.Y[s]-this.Y[i])/a,l=this.Vx[i]-r,c=this.Vy[i]-o,u=(b=this.Vx[s]*(this.X[i]-this.X[s])+this.Vy[s]*(this.Y[i]-this.Y[s]))*(this.X[i]-this.X[s])/a,p=b*(this.Y[i]-this.Y[s])/a,f=this.Vx[s]-u,m=this.Vy[s]-p,R=r-u,V=o-p,this.intens=(R*R+V*V)/5,this.intens>1&&(this.intens=1),this.evts_son[this.nb_sons]=new H,this.evts_son[this.nb_sons].played=!1,this.evts_son[this.nb_sons].temps=this.date*this.pas,this.evts_son[this.nb_sons].intensite=this.intens,this.evts_son[this.nb_sons].type_choc=2;q=this;var C=this.nb_sons+1;q.nb_sons=C,d=r,r=u,u=d,u*=this.RendementChoc,r*=this.RendementChoc,d=o,o=p,p=d,p*=this.RendementChoc,o*=this.RendementChoc,this.Vx[i]=r+l,this.Vy[i]=o+c,this.VQx[i]=this.Vx[i]-this.Rq[i],this.VQy[i]=this.Vy[i]+this.Rp[i],this.etat[s]==this.ARRET&&(this.Vx[s]=.94*this.Vx[s],this.Vy[s]=.94*this.Vy[s],_/=h=Math.sqrt(a),_=Math.abs(_),g=this.fbille*_,v=Math.abs(this.Rp[i]*(this.Y[s]-this.Y[i])-this.Rq[i]*(this.X[s]-this.X[i]))/h,y=(this.Vx[i]*(this.Y[s]-this.Y[i])-this.Vy[i]*(this.X[s]-this.X[i]))/h-this.Rr[i],M=Math.abs(y)<1e-5?Math.PI/2:Math.abs(Math.atan(v/y)),N=(y>0?1:-1)*g*Math.cos(M),this.Rr[s]=2.5*N,this.Rr[i]=this.Rr[i]-2.5*N,f=N*(this.Y[s]-this.Y[i])/h,m=-N*(this.X[s]-this.X[i])/h),this.Vx[s]=u+f,this.Vy[s]=p+m,this.VQx[s]=this.Vx[s]-this.Rq[s],this.VQy[s]=this.Vy[s]+this.Rp[s],this.etat[s]=this.QCQ,this.etat[i]=this.QCQ}}i++}return P}},{key:"fin_parcours",value:function(){var t=0;for(t=0;t<16;){if(this.etat[t]!=this.ARRET&&this.etat[t]!=this.EMPOCHEE){if(!(this.Vx[t]*this.Vx[t]+this.Vy[t]*this.Vy[t]<this.frpas*this.frpas))return!1;if(!(Math.abs(this.Rr[t])<this.Rfppas))return this.etat[t]=this.TSP,!1;this.date_arret[t]=this.date*this.pas,this.etat[t]=this.ARRET;var i=0;this.Vy[t]=0,this.Vx[t]=i;i=0;this.Rr[t]=0,this.Rq[t]=i,this.Rp[t]=i}t++}return!0}},{key:"choc_poche",value:function(t,i){var s,e=NaN;this.etat[t]==this.RSG?(this.Rp[t]=-this.Vy[t],this.Rq[t]=this.Vx[t]):this.etat[t]==this.QCQ&&(this.Rp[t]=-this.Vy[t]+this.VQy[t],this.Rq[t]=this.Vx[t]-this.VQx[t]),e=this.Vx[t]*Math.cos(i)+this.Vy[t]*Math.sin(i),s=-this.Vx[t]*Math.sin(i)+this.Vy[t]*Math.cos(i),e*=-this.EPSILON_COIN,this.Vx[t]=e*Math.cos(i)-s*Math.sin(i),this.Vy[t]=e*Math.sin(i)+s*Math.cos(i),this.VQx[t]=this.Vx[t]-this.Rq[t],this.VQy[t]=this.Vy[t]+this.Rp[t],this.etat[t]=this.QCQ}},{key:"add_clef",value:function(t){var i=this.nb_max_clefs*t+this.nb_clefs[t];this.evts[i]=new F,this.evts[i].X=this.X[t],this.evts[i].Y=this.Y[t],this.evts[i].RAp=this.RAp[t],this.evts[i].RAq=this.RAq[t],this.evts[i].RAr=this.RAr[t],this.evts[i].time=this.date*this.pas;var s=this.nb_clefs,e=t,a=s[t]+1;s[e]=a,this.X0[t]=this.X[t],this.Y0[t]=this.Y[t],this.RAp0[t]=this.RAp[t],this.RAq0[t]=this.RAq[t],this.RAr0[t]=this.RAr[t]}},{key:"init_pars",value:function(t){this.X[t]>this.XMAX&&this.Vx[t]>0&&(this.VN=-this.Vx[t],this.VRq=-this.Rq[t],this.Vy[t]>0?(this.VT=this.Vy[t],this.VRp=this.Rp[t],this.VRr=-this.Rr[t]):(this.VT=-this.Vy[t],this.VRp=-this.Rp[t],this.VRr=this.Rr[t])),this.X[t]<this.XMIN&&this.Vx[t]<0&&(this.VN=this.Vx[t],this.VRq=this.Rq[t],this.Vy[t]>0?(this.VT=this.Vy[t],this.VRp=this.Rp[t],this.VRr=this.Rr[t]):(this.VT=-this.Vy[t],this.VRp=-this.Rp[t],this.VRr=-this.Rr[t])),this.Y[t]<this.YMIN&&this.Vy[t]<0&&(this.VN=this.Vy[t],this.VRq=-this.Rp[t],this.Vx[t]>0?(this.VT=this.Vx[t],this.VRp=-this.Rq[t],this.VRr=-this.Rr[t]):(this.VT=-this.Vx[t],this.VRp=this.Rq[t],this.VRr=this.Rr[t])),this.Y[t]>this.YMAX&&this.Vy[t]>0&&(this.VN=-this.Vy[t],this.VRq=this.Rp[t],this.Vx[t]>0?(this.VT=this.Vx[t],this.VRp=-this.Rq[t],this.VRr=this.Rr[t]):(this.VT=-this.Vx[t],this.VRp=this.Rq[t],this.VRr=-this.Rr[t]))}},{key:"Calcul",value:function(t){var i,s,e=0,a=0,h=0,n=NaN,r=[0,0];for(e=0;e<16;){for(this.nb_clefs[e]=0,a=0;a<this.nb_max_clefs;)this.evts[this.nb_max_clefs*e+a]=null,a++;e++}for(this.nb_sons=0,e=0;e<this.nb_max_sons;)this.evts_son[e]=null,e++;for(e=0;e<16;)this.X[e]=t.Xinit[e],this.Y[e]=t.Yinit[e],this.RAp[e]=t.RApInit[e],this.RAq[e]=t.RAqInit[e],this.RAr[e]=t.RArInit[e],this.add_clef(e),e++;this.el=t.el,this.er=t.er,this.alph=t.alphaQ,this.beta=t.betaQ,this.vqueue=t.Vqueue,this.calculs_finis=!1,this.nbandes=0,this.done=!1,this.distance13=2,this.first_bille_choquee=0,this.choc12=!1,this.choc13=!1,this.done=!1,this.deltaclef=this.resolution,this.date=0,this.beta=this.beta+Math.PI,this.Vinit=1.4*this.vqueue*Math.cos(this.alph/1.2),i=-2*this.Vinit/Math.cos(this.alph/1.1)*this.er/this.R;var o=Math.PI/20;n=this.alph>o?Math.PI/2/(Math.PI/2-o)*(this.alph-o):0,s=4*this.vqueue*Math.sin(n)*this.el/this.R,this.Vx[0]=this.Vinit*Math.cos(this.beta),this.Vx0=this.Vx[0],this.Vy[0]=this.Vinit*Math.sin(this.beta),this.Vy0=this.Vy[0];var l=i*Math.sin(this.beta)+s*Math.cos(this.beta);this.Rp[0]=i*Math.sin(this.beta)+s*Math.cos(this.beta),this.p0=l;l=-i*Math.cos(this.beta)+s*Math.sin(this.beta);this.Rq[0]=-i*Math.cos(this.beta)+s*Math.sin(this.beta),this.q0=l;l=2*this.el/this.R*this.Vinit;for(this.Rr[0]=2*this.el/this.R*this.Vinit,this.r0=l,this.VQx[0]=this.Vx[0]-this.Rq[0],this.VQy[0]=this.Vy[0]+this.Rp[0],this.etat[0]=this.QCQ,this.time_empochee[0]=1e3,this.immobile[0]=!1,this.date_arret[0]=1e3,e=1;e<16;)this.Vx[e]=0,this.Vy[e]=0,this.VQx[e]=0,this.VQy[e]=0,this.Rp[e]=0,this.Rq[e]=0,this.Rr[e]=0,t.empocheeInit[e]?(this.etat[e]=this.EMPOCHEE,this.time_empochee[e]=0):(this.etat[e]=this.ARRET,this.time_empochee[e]=1e3,this.immobile[e]=!0,this.date_arret[e]=1e3,this.add_clef(e)),e++;this.evts_son[this.nb_sons]=new H,this.evts_son[this.nb_sons].played=!1,this.evts_son[this.nb_sons].temps=0,this.evts_son[this.nb_sons].intensite=this.Vinit/5.4,this.alph>Math.PI/4?this.evts_son[this.nb_sons].type_choc=0:this.evts_son[this.nb_sons].type_choc=1;l=this;var c=this.nb_sons+1;for(l.nb_sons=c;!this.fin_parcours();){l=this,c=this.date+1;for(l.date=c,this.choc_billes(r),e=0;e<16;){if(this.etat[e]!=this.ARRET&&this.etat[e]!=this.EMPOCHEE){if(1==(h=this.traiter_poches(e))&&this.choc_bande(e)){this.add_clef(e),this.evts_son[this.nb_sons]=new H,this.evts_son[this.nb_sons].played=!1,this.evts_son[this.nb_sons].temps=this.date*this.pas,this.evts_son[this.nb_sons].intensite=this.intens,this.evts_son[this.nb_sons].type_choc=3;l=this,c=this.nb_sons+1;l.nb_sons=c}if(3==h&&this.add_clef(e),4==h){this.add_clef(e),this.evts_son[this.nb_sons]=new H,this.evts_son[this.nb_sons].played=!1,this.evts_son[this.nb_sons].temps=this.date*this.pas,this.evts_son[this.nb_sons].intensite=.8,this.evts_son[this.nb_sons].type_choc=4;l=this,c=this.nb_sons+1;l.nb_sons=c}this.mise_a_jour(e)&&this.add_clef(e)}(Math.abs(this.X[e]-this.X0[e])>this.deltaclef||Math.abs(this.Y[e]-this.Y0[e])>this.deltaclef||Math.abs(this.RAp[e]-this.RAp0[e])>this.deltaclefRot||Math.abs(this.RAq[e]-this.RAq0[e])>this.deltaclefRot||Math.abs(this.RAr[e]-this.RAr0[e])>this.deltaclefRot)&&this.add_clef(e),e++}}if(this.fin_parcours()){for(this.calculs_finis=!0,e=0;e<16;)this.Xfin[e]=this.X[e],this.Yfin[e]=this.Y[e],this.RApfin[e]=this.RAp[e],this.RAqfin[e]=this.RAq[e],this.RArfin[e]=this.RAr[e],this.empochee_fin[e]=this.etat[e]==this.EMPOCHEE,this.add_clef(e),e++;this.duree=this.date*this.pas}else for(e=0;e<16;)this.add_clef(e),e++;return this.evts}},{key:"traiter_poches",value:function(t){var i=0,s=NaN,e=NaN,a=NaN,h=NaN;this.X[t]>0&&this.Y[t]>0&&(i=1),this.X[t]<0&&this.Y[t]>0&&(i=2),this.X[t]<0&&this.Y[t]<0&&(i=3),this.X[t]>0&&this.Y[t]<0&&(i=4),this.Symetrise_Params(t,i);var n=0;return Math.sqrt((this.X[t]-this.XTROU)*(this.X[t]-this.XTROU)+(this.Y[t]-this.YTROU)*(this.Y[t]-this.YTROU))<this.RTROU?(this.etat[t]=this.EMPOCHEE,this.time_empochee[t]=this.date*this.pas,n=4,this.Symetrise_Params(t,i),n):Math.sqrt((this.X[t]-this.XTROU2)*(this.X[t]-this.XTROU2)+(this.Y[t]-this.YTROU2)*(this.Y[t]-this.YTROU2))<this.RTROU?(this.etat[t]=this.EMPOCHEE,this.time_empochee[t]=this.date*this.pas,n=4,this.Symetrise_Params(t,i),n):(this.X[t]<this.XMIN&&(this.Y[t]<this.YA&&this.Vx[t]<0?n=1:(s=Math.sqrt((this.X[t]-this.XA)*(this.X[t]-this.XA)+(this.Y[t]-this.YA)*(this.Y[t]-this.YA)),5*Math.PI/180,s<this.R?this.Vx[t]*(this.X[t]-this.XA)+this.Vy[t]*(this.Y[t]-this.YA)<0&&(e=Math.acos((this.X[t]-this.XA)/s),this.choc_poche(t,e),n=3):this.Y[t]>this.YB&&(this.Vy[t]<0||Math.atan(-this.Vy[t]/this.Vx[t])<this.angle_poche_coin)&&this.Y[t]<this.a1*this.X[t]+this.b1?(this.choc_poche(t,Math.PI/2-this.angle_poche_coin),n=3):n=2)),this.Y[t]>this.YMAX&&(this.X[t]>this.XC&&this.X[t]<this.XE&&this.Vy[t]>0?n=1:this.X[t]<this.XC?(a=Math.sqrt((this.X[t]-this.XC)*(this.X[t]-this.XC)+(this.Y[t]-this.YC)*(this.Y[t]-this.YC)))<this.R?this.Vx[t]*(this.X[t]-this.XC)+this.Vy[t]*(this.Y[t]-this.YC)<0&&(e=Math.acos((this.XC-this.X[t])/a),this.choc_poche(t,e),n=3):this.Y[t]>this.YD&&(this.Vx[t]>0||Math.atan(-this.Vy[t]/this.Vx[t])>Math.PI/2-this.angle_poche_coin)&&this.Y[t]>this.a2*this.X[t]+this.b2&&(this.choc_poche(t,this.angle_poche_coin),n=3):this.X[t]>this.XE?(h=Math.sqrt((this.X[t]-this.XE)*(this.X[t]-this.XE)+(this.Y[t]-this.YE)*(this.Y[t]-this.YE)))<this.R&&this.Y[t]<this.YE?this.Vx[t]*(this.X[t]-this.XE)+this.Vy[t]*(this.Y[t]-this.YE)<0&&(e=Math.PI/2+Math.acos((this.YE-this.Y[t])/h),this.choc_poche(t,e),n=3):this.Y[t]>this.YE&&this.Y[t]>this.a3*this.X[t]+this.b3?(this.choc_poche(t,this.angle_poche_centrale),n=3):n=2:n=2),this.Symetrise_Params(t,i),n)}}]),t}(),Z=function(){function t(i,s,e,a){Object(r.a)(this,t),this.mode_jeu=7,this.RAp0=[],this.RAq0=[],this.cl=[],this.RAr0=[],this.ind_last_clef=[],this.ombre=[],this.ralenti=1,this.ecl=[],this.largeur_bandes=.26,this.billes=[];var h=0;this.cl=[],this.Ech=e,this.R=.03,this.Rb=36,this.type=0,this.taille(i),this.Params=new W(2*(this.xmax+this.R),2*(this.ymax+this.R)),h=0,this.aff_trajets=!1,this.tous_trajets=!0,this.trajet_bille_joueur=!1,this.trajet_bille_visee=!1,this.cl[0]=16777215,this.cl[8]=0,this.cl[9]=16777113,this.cl[1]=16776960,this.cl[10]=10092543,this.cl[2]=255,this.cl[3]=16711680,this.cl[11]=16751001,this.cl[4]=16711935,this.cl[12]=16751103,this.cl[5]=16750848,this.cl[13]=16750950,this.cl[6]=65280,this.cl[14]=10092441,this.cl[7]=6684723,this.cl[15]=10053120,this.billes=[],this.bille_visee=1,this.ecl=[],h=0;for(this.dq0=1.5*this.R*this.Ech,this.alphamin=!0,this.Vqmax=4.2,this.Simulateur=new K(this.xmax,this.ymax),this.ind_last_clef=[],h=0;h<16;)this.ind_last_clef[h]=this.Simulateur.nb_max_clefs*h,h++;for(this.calculs_faits=!1,this.ampl_recul_max=.1,this.RAp0=[],this.RAq0=[],this.RAr0=[],h=0;h<16;)this.RAp0[h]=0,this.RAq0[h]=0,this.RAr0[h]=0,h++;this.new_seq&&(this.seq.seq_id="",this.seq_origine.seq_id=""),this.alphamin=!1}return Object(o.a)(t,[{key:"tracer_grille",value:function(){var t=0;for(this.grille.graphics.clear(),this.grille.graphics.lineStyle(1,16776960,.2),t=-3;t<4;)this.grille.graphics.moveTo(this.ctrl.XC-this.Ech*(this.xmax+this.R),this.ctrl.YC+t*this.Ech*(this.ymax+this.R)/4),this.grille.graphics.lineTo(this.ctrl.XC+this.Ech*(this.xmax+this.R),this.ctrl.YC+t*this.Ech*(this.ymax+this.R)/4),t++;for(t=-7;t<8;)this.grille.graphics.moveTo(this.ctrl.XC+t*this.Ech*(this.xmax+this.R)/8,this.ctrl.YC+this.Ech*(this.ymax+this.R)),this.grille.graphics.lineTo(this.ctrl.XC+t*this.Ech*(this.xmax+this.R)/8,this.ctrl.YC-this.Ech*(this.ymax+this.R)),t++}},{key:"finir_init",value:function(){this.tracer_ligne_visee(),this.afficher_billes(),this.placer_queue(this.dq0),this.tracer_grille(),this.seq.titre=new String(this.ctrl.msg.msg[5])}},{key:"entier",value:function(t){var i=10*t;return t-(i/=10)>.5?i+1:i}},{key:"remettre_bille",value:function(t){var i=!1,s=0;if(!(9==this.mode_jeu&&t>9)&&!(10==this.mode_jeu&&t>10)){do{for(this.Params.Xinit[t]=2*(Math.random()-.5)*this.xmax,this.Params.Yinit[t]=2*(Math.random()-.5)*this.ymax,i=!0,s=0;s<16&&i;)this.Params.empocheeInit[s]||t==s||(this.Params.Xinit[t]-this.Params.Xinit[s])*(this.Params.Xinit[t]-this.Params.Xinit[s])+(this.Params.Yinit[t]-this.Params.Yinit[s])*(this.Params.Yinit[t]-this.Params.Yinit[s])<.004&&(i=!1),s++}while(!i);this.Params.empocheeInit[t]=!1}}},{key:"placer_queue",value:function(t){var i=-this.Params.betaQ;this.Ech,this.Params.el;this.alphamin?this.Params.alphaQ=NaN:this.Params.alphaQ<NaN&&(this.Params.alphaQ=NaN),this.queue.rotation=180*i/Math.PI,this.queue.scaleX=.25*Math.cos(this.Params.alphaQ)}},{key:"restore_seq",value:function(){var t=0,i=0;if(console.log("avant restore",this.seq.nb_points,this.seq_origine.nb_points),0!=this.seq_origine.nb_points){for(this.seq.nb_points=this.seq_origine.nb_points,this.seq.pt_courant=0,this.seq.auteur=this.seq_origine.auteur,this.seq.titre=this.seq_origine.titre,this.seq.seq_auto=this.seq_origine.seq_auto,this.ctrl.aff_auteur.text=this.seq.auteur,this.ctrl.aff_auteur.setTextFormat(this.ctrl.myFormatJauneKozoomCentre),this.ctrl.aff_titre.visible=!0,t=0;t<this.seq_origine.nb_points;){for(this.seq.points_b[t].taille_billard=this.seq_origine.points_b[t].taille_billard,this.seq.points_b[t].mode_jeu=this.seq_origine.points_b[t].mode_jeu,i=0;i<16;)this.seq.points_b[t].Xinit[i]=this.seq_origine.points_b[t].Xinit[i],this.seq.points_b[t].Yinit[i]=this.seq_origine.points_b[t].Yinit[i],i++;this.seq.points_b[t].Vqueue=this.seq_origine.points_b[t].Vqueue,this.seq.points_b[t].alphaQ=this.seq_origine.points_b[t].alphaQ,this.seq.points_b[t].betaQ=this.seq_origine.points_b[t].betaQ,this.seq.points_b[t].el=this.seq_origine.points_b[t].el,this.seq.points_b[t].er=this.seq_origine.points_b[t].er,t++}console.log("apres restore",this.seq.nb_points,this.seq_origine.nb_points)}}},{key:"Placer_billes_hasard",value:function(){var t=!1,i=0,s=0;for(i=0;i<16;){do{for(this.Params.Xinit[i]=2*(Math.random()-.5)*this.xmax,this.Params.Yinit[i]=2*(Math.random()-.5)*this.ymax,t=!0,s=0;s<i&&t;)(this.Params.Xinit[i]-this.Params.Xinit[s])*(this.Params.Xinit[i]-this.Params.Xinit[s])+(this.Params.Yinit[i]-this.Params.Yinit[s])*(this.Params.Yinit[i]-this.Params.Yinit[s])<.0016&&(t=!1),s++}while(!t);i++}}},{key:"charger_point",value:function(t,i){var s=0;for(s=0;s<16;)this.Params.Xinit[s]=t.Xinit[s],this.Params.Yinit[s]=t.Yinit[s],this.Params.empocheeInit[s]=t.empocheeInit[s],s++;this.Params.alphaQ=t.alphaQ,this.Params.betaQ=t.betaQ,this.Params.Vqueue=t.Vqueue,this.Params.el=t.el,this.Params.er=t.er,this.init_point(),i&&(this.Simulateur.Calcul(this.Params),this.calculs_faits=!0,this.aff_trajets=!0,this.afficher_trajets()),this.ctrl.modif_pt_seq=!1}},{key:"replacer",value:function(){this.arret_son(),this.ctrl.simulation_en_cours=!1,this.myTimer.stop(),this.afficher_billes(),this.placer_queue(this.dq0),this.queue.visible=!0}},{key:"afficher_trajets",value:function(){var t=0;for(t=0;t<16;){var i=!this.Params.empocheeInit[t];this.ombre[t].visible=!this.Params.empocheeInit[t],this.ecl[t].visible=i,this.billes[t].cont_bille.visible=i,t++}if(this.ligne_visee.visible=!0,this.trajets.graphics.clear(),this.tous_trajets||this.trajet_bille_joueur||this.trajet_bille_visee)if(this.calculs_faits||(this.Simulateur.Calcul(this.Params),this.calculs_faits=!0),this.tous_trajets)for(t=0;t<16;)this.aff_trajet_bille(t),t++;else this.trajet_bille_joueur&&this.aff_trajet_bille(0),this.trajet_bille_visee&&this.Params.noba&&this.aff_trajet_bille(this.bille_visee)}},{key:"timerHandler",value:function(t){var i=0,s=0,e=NaN,a=NaN,h=NaN,n=NaN,r=NaN,o=NaN,l=NaN;if(this.date<this.temps_recul)return this.queue.visible=!0,this.dq=this.dq0+this.Ampl_queue*(1-Math.cos(Math.PI*this.date/this.temps_recul)),void this.placer_queue(this.dq);if(this.date<this.t_debut&&(this.queue.visible=!0,this.dq=this.R*this.Ech+(2*this.Ampl_queue+this.dq0-this.R*this.Ech)*Math.cos(Math.PI/2*(this.date-this.temps_recul)/(this.t_debut-this.temps_recul)),this.placer_queue(this.dq)),this.date>this.t_debut+1&&(this.queue.visible=!1),!(this.date<this.t_debut)){if(!this.muet)for(i=this.nb_sons_played;i<this.Simulateur.nb_sons;){if(!this.Simulateur.evts_son[i].played&&this.Simulateur.evts_son[i].temps<this.date-this.t_debut){0==this.Simulateur.evts_son[i].type_choc?(this.canal_queue=this.son_queue_plat.play(0,1),this.trans=this.canal_queue.soundTransform,this.trans.volume=this.Simulateur.evts_son[i].intensite,this.canal_queue.soundTransform=this.trans):1==this.Simulateur.evts_son[i].type_choc?(this.canal_queue=this.son_queue_pique.play(0,1),this.trans=this.canal_queue.soundTransform,this.trans.volume=this.Simulateur.evts_son[i].intensite,this.canal_queue.soundTransform=this.trans):2==this.Simulateur.evts_son[i].type_choc?this.jouer_bille0?(this.canal_bille0=this.son_bille_bille.play(0,1),this.trans=this.canal_bille0.soundTransform,this.trans.volume=this.Simulateur.evts_son[i].intensite,this.canal_bille0.soundTransform=this.trans,null!=this.canal_bille1&&this.canal_bille1.stop(),this.jouer_bille0=!1):(this.canal_bille1=this.son_bille_bille.play(0,1),this.trans=this.canal_bille1.soundTransform,this.trans.volume=this.Simulateur.evts_son[i].intensite,this.canal_bille1.soundTransform=this.trans,null!=this.canal_bille0&&this.canal_bille0.stop(),this.jouer_bille0=!0):3==this.Simulateur.evts_son[i].type_choc?this.jouer_bande0?(this.canal_bande0=this.son_bille_bande.play(0,1),this.trans=this.canal_bande0.soundTransform,this.trans.volume=this.Simulateur.evts_son[i].intensite,this.canal_bande0.soundTransform=this.trans,null!=this.canal_bande1&&this.canal_bande1.stop(),this.jouer_bande0=!1):(this.canal_bande1=this.son_bille_bande.play(0,1),this.trans=this.canal_bande1.soundTransform,this.trans.volume=this.Simulateur.evts_son[i].intensite,this.canal_bande1.soundTransform=this.trans,null!=this.canal_bande0&&this.canal_bande0.stop(),this.jouer_bande0=!0):4==this.Simulateur.evts_son[i].type_choc&&(this.jouer_poche0?(this.canal_poche0=this.son_poche.play(0,1),this.trans=this.canal_poche0.soundTransform,this.trans.volume=this.Simulateur.evts_son[i].intensite,this.canal_poche0.soundTransform=this.trans,null!=this.canal_poche1&&this.canal_poche1.stop(),this.jouer_poche0=!1):(this.canal_poche1=this.son_poche.play(0,1),this.trans=this.canal_poche1.soundTransform,this.trans.volume=this.Simulateur.evts_son[i].intensite,this.canal_poche1.soundTransform=this.trans,null!=this.canal_poche0&&this.canal_poche0.stop(),this.jouer_poche0=!0)),this.Simulateur.evts_son[i].played=!0;var c=this,u=this.nb_sons_played+1;c.nb_sons_played=u}i++}for(i=0;i<16;){if(!this.Simulateur.immobile[i]&&this.Simulateur.date_arret[i]>this.date-this.t_debut)if(this.date-this.t_debut>this.Simulateur.time_empochee[i]){c=!1;this.ombre[i].visible=!1,this.ecl[i].visible=c,this.billes[i].cont_bille.visible=c}else{for(s=this.ind_last_clef[i];null!=this.Simulateur.evts[s+1]&&this.date-this.t_debut>this.Simulateur.evts[s+1].time;)s++;this.ind_last_clef[i]=s,null!=this.Simulateur.evts[s+1]&&(l=(this.date-this.t_debut-this.Simulateur.evts[s].time)/(this.Simulateur.evts[s+1].time-this.Simulateur.evts[s].time),this.billes[i].cont_bille.x=this.ctrl.XC+this.entier(this.Ech*(this.Simulateur.evts[s].X+(this.Simulateur.evts[s+1].X-this.Simulateur.evts[s].X)*l)),this.billes[i].cont_bille.y=this.ctrl.YC-this.entier(this.Ech*(this.Simulateur.evts[s].Y+(this.Simulateur.evts[s+1].Y-this.Simulateur.evts[s].Y)*l)),this.ecl[i].x=this.billes[i].cont_bille.x-this.Rb/4,this.ecl[i].y=this.billes[i].cont_bille.y-this.Rb/4,this.ombre[i].x=this.billes[i].cont_bille.x-this.Rb/3,this.ombre[i].y=this.billes[i].cont_bille.y-this.Rb/3,e=this.Simulateur.evts[s].RAp+(this.Simulateur.evts[s+1].RAp-this.Simulateur.evts[s].RAp)*l,a=this.Simulateur.evts[s].RAq+(this.Simulateur.evts[s+1].RAq-this.Simulateur.evts[s].RAq)*l,h=this.Simulateur.evts[s].RAr+(this.Simulateur.evts[s+1].RAr-this.Simulateur.evts[s].RAr)*l,n=(e-this.RAp0[i])/this.R,r=(a-this.RAq0[i])/this.R,o=(h-this.RAr0[i])/this.R,this.RAp0[i]=e,this.RAq0[i]=a,this.RAr0[i]=h,this.billes[i].tourner_bille(n,r,o))}i++}this.date-this.t_debut>this.Simulateur.duree&&(this.myTimer.stop(),this.aff_trajets=!0,this.afficher_trajets(),this.arret_son(),this.ctrl.FS&&this.replacer()),t.updateAfterEvent()}}},{key:"afficher_billes",value:function(){var t=0;for(t=0;t<16;)this.afficher_une_bille(t),t++}},{key:"replacer_rien",value:function(){var t=0;for(this.arret_son(),this.ctrl.simulation_en_cours=!1,this.myTimer.stop(),t=1;t<16;)this.Params.empocheeInit[t]=!0,t++;this.init_point()}},{key:"aff_trajet_bille",value:function(t){var i=0;for(i=this.Simulateur.nb_max_clefs*t,this.trajets.graphics.lineStyle(2,this.billes[t].couleur,.7),this.trajets.graphics.moveTo(this.ctrl.XC+this.Ech*this.Simulateur.evts[i].X,this.ctrl.YC-this.Ech*this.Simulateur.evts[i].Y);null!=this.Simulateur.evts[i+1];)i+=1,this.trajets.graphics.lineTo(this.ctrl.XC+this.Ech*this.Simulateur.evts[i].X,this.ctrl.YC-this.Ech*this.Simulateur.evts[i].Y)}},{key:"suivant",value:function(){var t=0,i=!1,s=0;for(this.arret_son(),this.ctrl.simulation_en_cours=!1,this.myTimer.stop(),this.calculs_faits||(this.Simulateur.Calcul(this.Params),this.calculs_faits=!0),t=0;t<16;)this.Params.Xinit[t]=this.Simulateur.Xfin[t],this.Params.Yinit[t]=this.Simulateur.Yfin[t],this.Params.RApInit[t]=0,this.Params.RAqInit[t]=0,this.Params.RArInit[t]=0,this.Params.empocheeInit[t]=this.Simulateur.empochee_fin[t],t++;if(this.Params.empocheeInit[0]){this.Params.empocheeInit[0]=!1;do{for(this.Params.Xinit[0]=2*(Math.random()-.5)*this.xmax,this.Params.Yinit[0]=2*(Math.random()-.5)*this.ymax,i=!0,s=1;s<16&&i;)this.Params.empocheeInit[s]||(this.Params.Xinit[0]-this.Params.Xinit[s])*(this.Params.Xinit[0]-this.Params.Xinit[s])+(this.Params.Yinit[0]-this.Params.Yinit[s])*(this.Params.Yinit[0]-this.Params.Yinit[s])<.004&&(i=!1),s++}while(!i)}this.init_point()}},{key:"tracer_ligne_visee",value:function(){var t=NaN,i=NaN,s=NaN,e=NaN,a=NaN,h=NaN;this.ligne_visee.graphics.clear(),this.Params.Quantite();var n=this.Params.betaQ+Math.PI,r=this.Params.Xinit[0],o=this.Params.Yinit[0],l=Math.tan(n);this.Params.noba?(h=Math.sqrt((this.Params.Xinit[this.Params.bille_visee]-r)*(this.Params.Xinit[this.Params.bille_visee]-r)+(this.Params.Yinit[this.Params.bille_visee]-o)*(this.Params.Yinit[this.Params.bille_visee]-o)),0!=Math.cos(n)?(e=r+h*Math.cos(n),a=o+h*Math.sin(n)):Math.sin(n)>0?(e=r,a=o+h):(e=r,a=o-h)):(i=this.largeur/2-.03,Math.cos(n)>0?t=this.longueur/2-.03:Math.cos(n)<0&&(t=-this.longueur/2+.03),0==Math.cos(n)?Math.sin(n)>0?(e=0,a=i):(e=0,a=-i):(s=(t-r)*l+o)>i?(e=r+(i-o)/l,a=i):s<-i?(e=r-(i+o)/l,a=-i):(e=t,a=(t-r)*l+o)),this.ligne_visee.graphics.lineStyle(1,16777215,.4),this.ligne_visee.graphics.moveTo(this.ctrl.XC+this.Ech*r,this.ctrl.YC-this.Ech*o),this.ligne_visee.graphics.lineTo(this.ctrl.XC+this.Ech*e,this.ctrl.YC-this.Ech*a)}},{key:"save_seq",value:function(){var t=0,i=0;for(console.log("avant save_seq",this.seq.nb_points,this.seq_origine.nb_points),this.seq_origine.nb_points=this.seq.nb_points,this.seq_origine.pt_courant=0,this.seq_origine.auteur=this.seq.auteur,this.seq_origine.titre=this.seq.titre,this.seq_origine.seq_auto=this.seq.seq_auto,t=0;t<this.seq.nb_points;){for(this.seq_origine.points_b[t].taille_billard=this.seq.points_b[t].taille_billard,this.seq_origine.points_b[t].mode_jeu=this.seq.points_b[t].mode_jeu,i=0;i<16;)this.seq_origine.points_b[t].Xinit[i]=this.seq.points_b[t].Xinit[i],this.seq_origine.points_b[t].Yinit[i]=this.seq.points_b[t].Yinit[i],i++;this.seq_origine.points_b[t].Vqueue=this.seq.points_b[t].Vqueue,this.seq_origine.points_b[t].alphaQ=this.seq.points_b[t].alphaQ,this.seq_origine.points_b[t].betaQ=this.seq.points_b[t].betaQ,this.seq_origine.points_b[t].el=this.seq.points_b[t].el,this.seq_origine.points_b[t].er=this.seq.points_b[t].er,t++}}},{key:"arret_son",value:function(){null!=this.canal_bille0&&this.canal_bille0.stop(),null!=this.canal_bille1&&this.canal_bille1.stop(),null!=this.canal_bande0&&this.canal_bande0.stop(),null!=this.canal_bande1&&this.canal_bande1.stop()}},{key:"init_point",value:function(){this.ctrl.simulation_en_cours=!1,this.arret_son(),this.myTimer.stop(),this.afficher_billes(),this.ctrl.aff_parametres(),this.placer_queue(this.dq0),this.queue.visible=!0,this.calculs_faits=!1,this.aff_trajets=!1,this.trajets.graphics.clear(),this.tracer_ligne_visee(),this.ligne_visee.visible=!0}},{key:"update_modejeu",value:function(t){var i=0;if(this.mode_jeu=t,this.ctrl.simulation_en_cours=!1,this.myTimer.stop(),7==t)for(i=10;i<16;)this.Params.empocheeInit[i]=!1,i++;if(8==t)for(i=10;i<16;)this.Params.empocheeInit[i]=!1,i++;if(9==t)for(i=10;i<16;)this.Params.empocheeInit[i]=!0,i++;if(10==t)for(i=11;i<16;)this.Params.empocheeInit[i]=!0,i++;this.afficher_billes()}},{key:"replacer_tout",value:function(){var t=0,i=0;for(this.arret_son(),this.ctrl.simulation_en_cours=!1,this.myTimer.stop(),this.mode_jeu<9&&(i=16),9==this.mode_jeu&&(i=10),10==this.mode_jeu&&(i=11),t=0;t<i;)this.Params.empocheeInit[t]&&this.remettre_bille(t),t++;this.init_point()}},{key:"Simuler",value:function(t,i){console.log("simulate");return this.ralenti=t,this.Params=i,this.Simulateur.Calcul(this.Params)}},{key:"taille",value:function(t){this.taille_billard=t,280==t&&(this.longueur=2.8),this.xmax=(this.longueur-this.largeur_bandes)/2-.03,this.ymax=(this.longueur-this.largeur_bandes)/4-.03,this.largeur=2*(this.ymax+.03)+this.largeur_bandes}},{key:"afficher_une_bille",value:function(t){var i=!this.Params.empocheeInit[t];this.ombre[t].visible=!this.Params.empocheeInit[t],this.ecl[t].visible=i,this.billes[t].cont_bille.visible=i,this.billes[t].cont_bille.x=this.ctrl.XC+this.entier(this.Params.Xinit[t]*this.Ech),this.billes[t].cont_bille.y=this.ctrl.YC-this.entier(this.Params.Yinit[t]*this.Ech),this.ombre[t].x=this.billes[t].cont_bille.x-this.Rb/3,this.ombre[t].y=this.billes[t].cont_bille.y-this.Rb/3,this.ecl[t].x=this.billes[t].cont_bille.x-this.Rb/4,this.ecl[t].y=this.billes[t].cont_bille.y-this.Rb/4,this.billes[t].positionner_texture()}}]),t}(),J=function t(i,s,e,a,h,n){var o=this;Object(r.a)(this,t),this.getMesh=function(){return o.mesh},this.getPosition=function(){return Object.assign({},o.mesh.position)},this.getVisibility=function(){return o.mesh.visibility},this.updatePosition=function(t,i){o.mesh.position.x=t,o.mesh.position.z=i},this.updateRotation=function(t,i,s){var e=(t-o.RAp0)/.03,a=(i-o.RAq0)/.03,h=(s-o.RAr0)/.03;o.RAp0=t,o.RAq0=i,o.RAr0=s,o.mesh.rotate(_.Axis.X,-e,_.Space.WORLD),o.mesh.rotate(_.Axis.Y,-h,_.Space.WORLD),o.mesh.rotate(_.Axis.Z,-a,_.Space.WORLD)},this.isPotted=function(){return!o.mesh.visibility},this.pot=function(){o.mesh.visibility=!1},this.scene=i,this.mesh=_.Mesh.CreateSphere(s,16,e,this.scene),this.mesh.position.y=a.y,this.mesh.position.x=a.x,this.mesh.position.z=a.z;var l=new _.StandardMaterial("redMat",this.scene);l.diffuseTexture=new _.Texture(h,this.scene),this.mesh.material=l,this.mesh.rotation.y=Math.PI*Math.random(),this.mesh.rotation.x=Math.PI*Math.random(),this.mesh.rotation.z=Math.PI*Math.random(),this.mesh.visibility=n,this.RAp0=0,this.RAq0=0,this.RAr0=0},$=function t(i,s){var e=this;Object(r.a)(this,t),this.getMesh=function(){return e.mesh},this.update=function(t,i){e.mesh.position=t,e.mesh.rotation=i},this.updateDirectionLine=function(t,i){e.directionLine.position=t,e.directionLine.rotation.y=i},this.scene=i,this.mesh=s,this.mesh.position.y=50,this.mesh.position.z=90,this.directionLine=new _.MeshBuilder.CreateLines("direction-line",{points:[new _.Vector3(0,0,0),new _.Vector3(600,0,0)],colors:[new _.Color4(0,0,.8,1),new _.Color4(0,0,.8,1)]})},tt=function t(i,s){var e=this;Object(r.a)(this,t),this.getMeshes=function(){return e.meshes},this.scene=i,this.meshes=s},it=function(){function t(i,s,e,a,h){var n=this;Object(r.a)(this,t),this.drawBallPath=function(t){var i=n.pathData;if(i&&0!=i.length){var s=!0,e=!1,a=void 0;try{for(var h,r=n.pathes[Symbol.iterator]();!(s=(h=r.next()).done);s=!0){var o=h.value;o&&o.dispose()}}catch(b){e=!0,a=b}finally{try{s||null==r.return||r.return()}finally{if(e)throw a}}n.pathes=[];var l=[new _.Color4(1,1,1,1),new _.Color4(1,1,0,1),new _.Color4(.1,.2,.6,1),new _.Color4(.9,.2,.1,1),new _.Color4(.6,.1,.5,1),new _.Color4(1,.5,.1,1),new _.Color4(0,.6,.3,1),new _.Color4(.5,.1,.15,1),new _.Color4(0,0,0,1),new _.Color4(1,1,0,1),new _.Color4(.1,.12,.5,1),new _.Color4(.9,.2,.1,1),new _.Color4(.6,.1,.5,1),new _.Color4(.9,.5,0,1),new _.Color4(0,.6,.3,1),new _.Color4(.5,.1,.15,1)];if(t)for(var c=0;c<16;c++){for(var u=[],p=[],f=1e4*c;f<1e4*(c+1);f++)i[f]&&(u.push(new _.Vector3(U*i[f].X/n.size,n.ballRadius/2,U*i[f].Y/n.size)),p.push(l[c]));var m=_.MeshBuilder.CreateLines("lines",{points:u,colors:p},n.scene);n.pathes.push(m)}}},this.configCameras=function(){var t=n;t.cameras.arcCam=new _.ArcRotateCamera("Camera-Arc",4.44,1.05,300,_.Vector3.Zero(),t.scene),t.cameras.arcCam.attachControl(t.canvas),t.cameras.arcCam.upperBetaLimit=1.5,t.cameras.arcCam.wheelPrecision=.2,t.cameras.arcCam.upperRadiusLimit=500,t.cameras.arcCam.lowerRadiusLimit=100,t.cameras.topCam=new _.ArcRotateCamera("Camera-Top",-Math.PI/2,0,330,_.Vector3.Zero(),t.scene),t.cameras.topCam.upperBetaLimit=0,t.cameras.topCam.lowerBetaLimit=0,t.cameras.topCam.upperAlphaLimit=-Math.PI/2,t.cameras.topCam.lowerAlphaLimit=-Math.PI/2,t.cameras.topCam.upperRadiusLimit=330,t.cameras.topCam.lowerRadiusLimit=330,t.cameras.topCam.mode=_.Camera.ORTHOGRAPHIC_CAMERA,t.cameras.topCam.orthoTop=130,t.cameras.topCam.orthoBottom=-130,t.cameras.topCam.orthoLeft=-240,t.cameras.topCam.orthoRight=240,t.changeView(t.currentView)},this.loadModels=function(){var t=n,i=n.modelStorePath;_.SceneLoader.ImportMesh("",i,D,t.scene,function(s){t.objects.bat=new $(t.scene,s[0]),_.SceneLoader.ImportMesh("",i,z,t.scene,function(i){t.objects.table=new tt(t.scene,i),t.configCueBalls(),t.updateBat(t.controlOptions)})})},this.updateControlOptions=function(t){n.controlOptions=t,n.updateBat(t)},this.updateBat=function(t){var i=t.cueLine,s=t.cueAngle,e=t.sideEnglish,a=t.topSpin,h=n.size,r=n.ballRadius,o=n.objects,l=o.bat,c=o.balls,u=U*e/h,p=U*a/h,f=c[0].getPosition();c[0].isPotted()||(l.update({x:f.x-u*Math.sin(i)-p*Math.sin(s)*Math.cos(i),z:f.z+u*Math.cos(i)-p*Math.sin(s)*Math.sin(i),y:r/2+p*Math.cos(s)},{x:0,y:-i,z:Math.PI/2+s}),l.updateDirectionLine(f,Math.PI-i))},this.generateReflectionMaterial=function(t,i){for(var s=n.scene,e=new _.ReflectionProbe("satelliteProbe"+t.name,512,s),a=0;a<i.length;a++)e.renderList.push(i[a]);t.material.reflectionTexture=e.cubeTexture,t.material.reflectivityColor=new _.Color3(.3,.3,.3),t.material.reflectionFresnelParameters=new _.FresnelParameters,t.material.reflectionFresnelParameters.bias=0,e.attachToMesh(t)},this.configCueBalls=function(){var t=n,i=n.modelStorePath,s=n.ballRadius,e=n.ballPositions;t.objects.balls.push(new J(t.scene,"cue-ball-white",s,{x:e[0].x,y:s/2,z:e[0].z},i+"cueball-white.jpg",!0));for(var a=1;a<16;a++)t.objects.balls.push(new J(t.scene,"cue-ball-"+a,s,{x:e[a].x,y:s/2,z:e[a].z},i+"poolball/"+a+".jpg",!e[a].empocheeInit));for(a=0;a<16;a++){for(var h=[],r=0;r<16;r++)a!=r&&h.push(t.objects.balls[r].getMesh());h.push(t.objects.bat.getMesh()),h=h.concat(t.objects.table.getMeshes())}},this.configGrids=function(){for(var t=n,i=[new _.Color4(.7,.7,.7,1),new _.Color4(.7,.7,.7,1)],s=0;s<15;s++){var e=[new _.Vector3(7*-U/16+s*U/16,2,-U/4),new _.Vector3(7*-U/16+s*U/16,2,U/4)];t.grids.push(_.MeshBuilder.CreateLines("lines",{points:e,colors:i},t.scene))}for(s=0;s<7;s++){var a=[new _.Vector3(-U/2,2,3*-U/16+s*U/16),new _.Vector3(U/2,2,3*-U/16+s*U/16)];t.grids.push(_.MeshBuilder.CreateLines("lines",{points:a,colors:i},t.scene))}},this.toggleGrids=function(t){for(var i=n.grids,s=0;s<i.length;s++)i[s].visibility=t},this.initializeScene=function(t,i){var s=n;s.scene=t,s.canvas=i,s.scene.clearColor=new _.Color3(.05,.05,.05),new _.HemisphericLight("light",_.Vector3.Up(),t),s.configCameras(),s.loadModels(),s.configGrids(),s.scene.getEngine().runRenderLoop(function(){t&&(t.render(),s.animateBalls())}),i.addEventListener("pointerdown",s.onPointerDown,!1),i.addEventListener("pointerup",s.onPointerUp,!1),i.addEventListener("pointermove",s.onPointerMove,!1)},this.getGroundPosition=function(){var t=n.scene,i=t.pick(t.pointerX,t.pointerY,function(t){return"carpet"==t.name});return i.hit?i.pickedPoint:null},this.onPointerDown=function(t){var i=n,s=n.scene,e=n.canvas;if(0===t.button){var a=s.pick(s.pointerX,s.pointerY,function(t){return t.name.includes("cue-ball")});a.hit&&(i.currentMesh=a.pickedMesh,i.startingPoint=i.getGroundPosition(t),i.startingPoint&&setTimeout(function(){i.cameras.arcCam.detachControl(e)},0))}},this.onPointerUp=function(){var t=n,i=n.startingPoint,s=n.canvas;if(i)return t.cameras.arcCam.attachControl(s,!0),t.startingPoint=null,void(t.currentMesh=null)},this.onPointerMove=function(t){var i=n,s=n.startingPoint,e=n.currentMesh;if(s){var a=i.getGroundPosition(t);a&&(e.position=a,e.position.y=i.ballRadius/2,s=a,i.updateBat(i.controlOptions))}},this.moveAndRotateBall=function(t,i,s){var e,a=-1,h=n;for(e=1e4*s;e<1e4*(s+1)&&h.pathData[e];e++)h.pathData[e].time<i-h.t0&&(a=e);if(a>=0){var r=h.pathData[a],o=U*r.X/h.size,l=U*r.Y/h.size;t.updatePosition(o,l);var c=.6*h.ballRadius,u=Math.sqrt(Math.pow(U/2-Math.abs(o),2)+Math.pow(U/4-Math.abs(l),2)),p=Math.sqrt(Math.pow(Math.abs(o),2)+Math.pow(U/4-Math.abs(l),2));return(u<c||p<c)&&!t.isPotted()&&(console.log("potting"),t.pot()),t.updateRotation(h.pathData[a].RAp,h.pathData[a].RAq,h.pathData[a].RAr),a!=e-1}},this.animateBalls=function(){var t=n,i=n.objects.balls;if(t.pathData&&0!=t.pathData.length&&void 0!=t.t0){for(var s=(new Date).getTime()/1e3,e=0,a=0;a<16;a++){0==n.moveAndRotateBall(i[a],s,a)&&e++}console.log(e),16==e&&(t.pathData=[],setTimeout(function(){t.updateBat(t.controlOptions)},1e3))}},this.playSimulation=function(){var t=n,i=n.controlOptions,s=n.objects.balls,e=[],a=[],h=[],r=!0,o=!1,l=void 0;try{for(var c,u=s[Symbol.iterator]();!(r=(c=u.next()).done);r=!0){var p=c.value,f=p.getPosition();e.push(t.size*f.x/U),a.push(t.size*f.z/U),h.push(!p.getVisibility())}}catch(_){o=!0,l=_}finally{try{r||null==u.return||u.return()}finally{if(o)throw l}}var m=n.billard.Simuler(1,{Xinit:e,Yinit:a,empocheeInit:h,RApInit:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],RAqInit:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],RArInit:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],el:i.sideEnglish,er:i.topSpin,alphaQ:i.cueAngle,betaQ:i.cueLine,Vqueue:i.speed});m&&0!=m.length&&(n.pathData=m,n.drawBallPath(!0),n.t0=(new Date).getTime()/1e3)},this.scene=void 0,this.canvas=void 0,this.size=i,this.ballRadius=U*G/(100*this.size),this.modelStorePath=s,this.initBallPosition=a,this.ballPositions=[],console.log("init ball positions",a),console.log(this.ballPositions),this.currentView=e,this.cameras={arcCam:void 0,topCam:void 0},this.objects={table:void 0,bat:void 0,balls:[]},this.controlOptions=h,this.grids=[],this.pathes=[],this.billard=new Z(280,void 0,300),this.RAp0=[],this.RAq0=[],this.RAr0=[];for(var o=0;o<16;o++)this.RAp0.push(0),this.RAq0.push(0),this.RAr0.push(0),this.ballPositions.push({x:U*a.Xinit[o]/i,z:U*a.Yinit[o]/i,empocheeInit:a.empocheeInit[o]})}return Object(o.a)(t,[{key:"changeView",value:function(t){"2d"===t?(this.scene.activeCamera=this.cameras.topCam,this.cameras.arcCam.detachControl(this.canvas),this.cameras.topCam.attachControl(this.canvas)):(this.scene.activeCamera=this.cameras.arcCam,this.cameras.arcCam.attachControl(this.canvas),this.cameras.topCam.detachControl(this.canvas))}}]),t}(),st=function(t){function i(t){var s;return Object(r.a)(this,i),(s=Object(l.a)(this,Object(c.a)(i).call(this,t))).meshPicked=function(t){},s.drawBallPath=function(t){s.board.drawBallPath(t)},s.onSceneMount=function(t){var i=t.canvas,e=t.scene;s.board.initializeScene(e,i)},s.toggleGrids=function(t){s.board.toggleGrids(t)},s.playSimulation=function(){s.board.playSimulation()},s.updateControlOptions=function(t){s.board.updateControlOptions(t)},s.componentDidMount=function(){},s.state={showPath:!1},s.board=new it(s.props.size,s.props.modelStorePath,s.props.currentView,s.props.points,{cueLine:s.props.cueLine,cueAngle:s.props.cueAngle,sideEnglish:s.props.sideEnglish,topSpin:s.props.topSpin,speed:s.props.speed}),s.simulatorDom=new a.a.createRef,s}return Object(u.a)(i,t),Object(o.a)(i,[{key:"changeView",value:function(t){this.board.changeView(t)}},{key:"render",value:function(){return a.a.createElement(m.a,{canvasId:"carom-simulator-canvas"},a.a.createElement(m.b,{onMeshPicked:this.meshPicked,onSceneMount:this.onSceneMount}))}}]),i}(a.a.Component),et=(s(34),function(t){function i(t){var s;return Object(r.a)(this,i),(s=Object(l.a)(this,Object(c.a)(i).call(this,t))).componentWillReceiveProps=function(t){var i=t.value;s.setState({value:i})},s.updateValue=function(t){s.setState({value:t}),s.props.onUpdate(s.props.itemKey,t)},s.onChangeValue=function(t){var i=t.target.value;s.updateValue(i)},s.onMinusPressed=function(){var t=s.state.value,i=s.props,e=i.min,a=i.step;void 0===a&&(a=.1),(t=(10*t-(a*=10))/10)<e&&(t=e),s.updateValue(t)},s.onPlusPressed=function(){var t=s.state.value,i=s.props,e=i.max,a=i.step;void 0===a&&(a=.1),(t=(10*t+(a*=10))/10)>e&&(t=e),s.updateValue(t)},s.state={value:s.props.value?s.props.value:0},s}return Object(u.a)(i,t),Object(o.a)(i,[{key:"render",value:function(){var t=this.state.value,i=this.props,s=i.containerClass,e=i.label,h=i.min,n=i.max,r=i.unitDom,o=i.step;return void 0===o&&(o=.1),a.a.createElement("div",{className:s},a.a.createElement("div",{style:{display:"flex"}},a.a.createElement(Q.a,{icon:B.d,className:"btn-change-value",onClick:this.onMinusPressed}),a.a.createElement("span",{style:{flex:1,textAlign:"center"}},e,a.a.createElement("span",null," : ",t,r)),a.a.createElement(Q.a,{icon:B.f,className:"btn-change-value",onClick:this.onPlusPressed})),a.a.createElement("input",{type:"range",min:h,max:n,value:t,className:"slider",step:o,onChange:this.onChangeValue}))}}]),i}(a.a.Component)),at=(s(35),function(t){function i(t){var s;return Object(r.a)(this,i),(s=Object(l.a)(this,Object(c.a)(i).call(this,t))).onInputSliderUpdated=function(t,i){var e=Object.assign({},s.state);e[t]=parseFloat(i),s.setState(e);var a=Object.assign({},e);a.cueLine=Math.PI*e.cueLine/180,a.cueAngle=Math.PI*e.cueAngle/180,a.sideEnglish/=1e3,a.topSpin/=1e3,a.speed/=100,s.props.onControlOptionsUpdated(a)},s.state={cueLine:Math.round(1800*s.props.cueLine/Math.PI)/10,cueAngle:Math.round(1800*s.props.cueAngle/Math.PI)/10,sideEnglish:Math.round(1e4*s.props.sideEnglish)/10,topSpin:Math.round(1e4*s.props.topSpin)/10,speed:Math.round(100*s.props.speed)},s}return Object(u.a)(i,t),Object(o.a)(i,[{key:"render",value:function(){var t=this,i=this.state,s=i.cueLine,e=i.cueAngle,h=i.sideEnglish,n=i.topSpin,r=i.speed,o=this.props,l=o.showGrid,c=o.showPath,u="toggle-btn",p="toggle-btn";return!0===l&&(u+=" active"),!0===c&&(p+=" active"),a.a.createElement("div",null,a.a.createElement("div",{className:"common-controller-container"},a.a.createElement(Q.a,{className:u,icon:B.h,onClick:function(){t.props.onToggleShowGrid(!l)}}),a.a.createElement(Q.a,{className:p,icon:B.b,onClick:function(){t.props.onToggleShowPath(!c)}}),a.a.createElement(Q.a,{className:"toggle-btn",icon:B.i})),a.a.createElement("div",null,a.a.createElement(et,{label:"Cue Line",containerClass:"slider-container",min:0,max:360,value:s,unitDom:a.a.createElement("sup",null,"o"),itemKey:"cueLine",onUpdate:this.onInputSliderUpdated}),a.a.createElement(et,{label:"Cue Angle",containerClass:"slider-container",min:2,max:89,value:e,unitDom:a.a.createElement("sup",null,"o"),itemKey:"cueAngle",onUpdate:this.onInputSliderUpdated}),a.a.createElement("br",null),a.a.createElement(et,{label:"Side English",containerClass:"slider-container",min:-15.1,max:15.1,value:h,unitDom:a.a.createElement("span",null,"mm"),itemKey:"sideEnglish",onUpdate:this.onInputSliderUpdated}),a.a.createElement(et,{label:"Top Spin",containerClass:"slider-container",min:-15.1,max:15.1,value:n,unitDom:a.a.createElement("span",null,"mm"),itemKey:"topSpin",onUpdate:this.onInputSliderUpdated}),a.a.createElement(et,{label:"Speed",containerClass:"slider-container",min:0,max:450,value:r,step:1,unitDom:a.a.createElement("span",null,"cm/s"),itemKey:"speed",onUpdate:this.onInputSliderUpdated})),a.a.createElement("div",{className:"play-controller-container"},a.a.createElement(Q.a,{className:"play-controller",icon:B.a}),a.a.createElement(Q.a,{className:"play-controller",icon:B.g}),a.a.createElement(Q.a,{className:"play-controller",icon:B.e,onClick:this.props.onPlayPressed}),a.a.createElement(Q.a,{className:"play-controller",icon:B.c})))}}]),i}(a.a.Component)),ht=function(t){function i(){var t;return Object(r.a)(this,i),(t=Object(l.a)(this,Object(c.a)(i).call(this))).componentWillMount=function(){t.updateSimulateInfo()},t.updateSimulateInfo=function(){for(var i=["Stephan COHEN","...","0","280","9","1","0.09016666666666652","-0.15416666666666667","0","-0.7000000000000001","0","1","-0.6000000000000001","0","1","-0.5","0","1","-0.4","0","1","-0.30000000000000004","0","1","1.1278562236304084","0.5949669539121291","0","-0.7158538054923216","0.28840047307995464","0","0.09842832940320168","-0.3689576159836725","0","0.6413658575465282","-0.03231798897590485","0","0.2","0","1","0.30000000000000004","0","1","0.4","0","1","0.5","0","1","0.6000000000000001","0","1","0.7000000000000001","0","1","1.8639999999999999","0.03490658503988659","-2.4890317318711697","0.014000000000000002","0.004999999999999999"],s={size:2.54,points:{Xinit:[],Yinit:[],empocheeInit:[]}},e=6,a=0;a<16;)s.points.Xinit[a]=i[e],e++,s.points.Yinit[a]=i[e],e++,s.points.empocheeInit[a]=0!=i[e],e++,a++;s.speed=parseFloat(i[e]),e++,s.cueAngle=parseFloat(i[e]),e++,s.cueLine=parseFloat(i[e]),s.cueLine<0&&(s.cueLine+=2*Math.PI),e++,s.sideEnglish=parseFloat(i[e]),e++,s.topSpin=parseFloat(i[e]),console.log(s),t.setState(s)},t.viewSelectorItemClicked=function(i){t.setState({currentView:i}),t.simulator.current.changeView(i)},t.onToggleShowGrid=function(i){t.setState({showGrid:i}),t.simulator.current.toggleGrids(i)},t.onToggleShowPath=function(i){t.setState({showPath:i}),t.simulator.current.drawBallPath(i)},t.onPlayPressed=function(){t.simulator.current.playSimulation()},t.onControlOptionsUpdated=function(i){t.simulator.current.updateControlOptions(i)},t.componentDidMount=function(){},t.state={currentView:"2d",showGrid:!0,showPath:!1,size:310,cueLine:30/180*Math.PI,cueAngle:5/180*Math.PI,sideEnglish:-.0087,topSpin:.0075,speed:3.8,points:{Xinit:[],Yinit:[],empocheeInit:[]}},t.simulator=a.a.createRef(),t}return Object(u.a)(i,t),Object(o.a)(i,[{key:"render",value:function(){var t=this.state,i=t.currentView,s=t.showGrid,e=t.showPath,h=t.size,n=t.cueLine,r=t.cueAngle,o=t.sideEnglish,l=t.topSpin,c=t.speed,u=t.points;return a.a.createElement("div",{className:"simulator-container"},a.a.createElement(k,{currentView:i,viewSelectorItemClicked:this.viewSelectorItemClicked}),a.a.createElement(st,{modelStorePath:this.props.modelStorePath,ref:this.simulator,size:h,currentView:i,cueLine:n,cueAngle:r,sideEnglish:o,topSpin:l,speed:c,points:u}),a.a.createElement(at,{showGrid:s,showPath:e,cueLine:n,cueAngle:r,sideEnglish:o,topSpin:l,speed:c,onControlOptionsUpdated:this.onControlOptionsUpdated,onToggleShowGrid:this.onToggleShowGrid,onToggleShowPath:this.onToggleShowPath,onPlayPressed:this.onPlayPressed}))}}]),i}(a.a.Component);var nt=function(){return a.a.createElement("div",{className:"simulator-container"},a.a.createElement(ht,{modelStorePath:"./models/"}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n.a.render(a.a.createElement(nt,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}],[[19,1,2]]]);
//# sourceMappingURL=main.5f3fe292.chunk.js.map